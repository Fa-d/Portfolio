const a=["ctrl","alt","meta","shift"],b="__0_1_2_3_4_5_6_7_8_9_a_b_c_d_e_f_g_h_i_j_k_l_m_n_o_p_q_r_s_t_u_v_w_x_y_z_ _`_'_\"_~_!_@_#_$_%_^_&_*_(_)_._-_+_=_[_]_{_}_<_>_,_/_?_;_:_\\_|_capslock_numlock_enter_tab_arrowdown_arrowleft_arrowright_arrowup_end_home_pagedown_pageup_backspace_delete_insert_escape_f1_f2_f3_f4_f5_f6_f7_f8_f9_f10_f11_f12_f13_f14_f15_f16_f17_f18_f19_f20_f21_f22_f23".split("_");b[1]="_";const i={};for(const[e,t]of b.entries())i[t]=e;const p={space:" ",plus:"+",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright",esc:"escape"},d=4,l=9,_=l+d,x=2**d,u=2**_,g=2**(2*_),w=2**(3*_);function m(e){let t;return e==="+"?["+"]:(e.slice(-1)=="+"?(t=e.slice(0,-2).split("+"),t.push("+")):t=e.split("+"),t.map(n=>p[n]||n))}function C(e){const t=new Set(e);let n=i[e[e.length-1].toLowerCase()]||0;for(const c of a)n=2*n+(t.has(c)?1:0);return n}function $(e){return e>>d}function s(e){return e%x}function y(e,t){if(e===void 0||$(e)>0)return!1;const n=s(e),c=s(t);return n===c&&$(t)===0?!1:(n&s(t))===n}function S(e){let t=i[e.key.toLowerCase()]||0;for(const n of a)t=2*t+(e[`${n}Key`]?1:0);return t}function o(e){return e.map(m)}function r(e){if(e.length>4)throw"Can't encode sequence of more than 4 keys!";let t=0;for(const n of e)t=t*u+C(n);return t}function q(e){return e<u?1:e<g?2:e<w?3:4}function z(e){const t=[];let n=0,c=0;for(let f=e.length-1;f>=0;f--)n=2**c*e[f]+n,c=c+13,t.push(n);return t}function k(e={}){return{history:[],historySize:0,bindings:new Map,disabledSequenceCodes:new Set,...e}}function M(e,t,n){const c=r(o(t));return e.bindings.has(c)||e.bindings.set(c,new Set),e.bindings.get(c).add(n),h(e)}function v(e,t,n){const c=r(o(t)),f=e.bindings.get(c);return f&&(f.delete(n),f.size==0&&e.bindings.delete(c)),h(e)}function L(e,t){const n=r(o(t));return e.disabledSequenceCodes.delete(n),e}function j(e,t){const n=r(o(t));return e.disabledSequenceCodes.add(n),e}function A(e,t){const n=S(t),c=e.history.at(-1);return y(c,n)&&e.history.pop(),e.history.push(n),e.history.length>e.historySize&&e.history.shift(),e}function B(e){const t=[];for(const n of z(e.history))e.disabledSequenceCodes.has(n)||t.push(...e.bindings.get(n)||[]);return t}function D(e,t){e=A(e,t);const n=B(e);for(const c of n)c(t);return[e,n]}function h(e){e.historySize=0;for(const t of e.bindings.keys())e.historySize=Math.max(e.historySize,q(t));return e}class E{add(...t){const n=t.slice(0,-1),c=t.at(-1);return this.state=M(this.state,n,c),this}remove(...t){const n=t.slice(0,-1),c=t.at(-1);return this.state=v(this.state,n,c),this}enable(...t){return this.state=L(this.state,t),this}disable(...t){return this.state=j(this.state,t),this}handle(t){const[n,c]=D(this.state,t);return this.state=n,c.length>0}constructor(t){this.state=t,this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.handle=this.handle.bind(this)}}function F(){return new E(k())}export{F as $};
