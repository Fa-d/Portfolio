import{L as ie,a as $e,R as qe,U as We,B as Ve,M as Xe,C as Ye,b as Ke,O as Je,P as Qe,S as be,c as se,N as Ze,A as et,W as tt,d as nt,e as rt,f as ot,V as it,g as Z,h as st,i as at,T as ct}from"./three-D6Fw_2Dt.js";import{r as P}from"./react-BM9L5BSm.js";import{R as lt,c as X}from"./react-reconciler-BbLgqi1C.js";import{_ as Oe}from"./@babel-CF3RwP-h.js";import{u as ut}from"./react-use-measure-BLefPvwd.js";import{F as ft,u as dt}from"./its-fine-GO9PKd3v.js";var Ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function pt(e){let n;const o=new Set,c=(p,t)=>{const r=typeof p=="function"?p(n):p;if(r!==n){const i=n;n=t?r:Object.assign({},n,r),o.forEach(u=>u(n,i))}},d=()=>n,m=(p,t=d,r=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let i=t(n);function u(){const f=t(n);if(!r(i,f)){const _=i;p(i=f,_)}}return o.add(u),()=>o.delete(u)},a={setState:c,getState:d,subscribe:(p,t,r)=>t||r?m(p,t,r):(o.add(p),()=>o.delete(p)),destroy:()=>o.clear()};return n=e(c,d,a),a}const vt=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),_e=vt?P.useEffect:P.useLayoutEffect;function ht(e){const n=typeof e=="function"?pt(e):e,o=(c=n.getState,d=Object.is)=>{const[,m]=P.useReducer(h=>h+1,0),y=n.getState(),g=P.useRef(y),a=P.useRef(c),p=P.useRef(d),t=P.useRef(!1),r=P.useRef();r.current===void 0&&(r.current=c(y));let i,u=!1;(g.current!==y||a.current!==c||p.current!==d||t.current)&&(i=c(y),u=!d(r.current,i)),_e(()=>{u&&(r.current=i),g.current=y,a.current=c,p.current=d,t.current=!1});const f=P.useRef(y);_e(()=>{const h=()=>{try{const l=n.getState(),v=a.current(l);p.current(r.current,v)||(g.current=l,r.current=v,m())}catch{t.current=!0,m()}},s=n.subscribe(h);return n.getState()!==f.current&&h(),s},[]);const _=u?i:r.current;return P.useDebugValue(_),_};return Object.assign(o,n),o[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const c=[o,n];return{next(){const d=c.length<=0;return{value:c.shift(),done:d}}}},o}var je={exports:{}},ke={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(b,C){var S=b.length;b.push(C);e:for(;0<S;){var O=S-1>>>1,j=b[O];if(0<d(j,C))b[O]=C,b[S]=j,S=O;else break e}}function o(b){return b.length===0?null:b[0]}function c(b){if(b.length===0)return null;var C=b[0],S=b.pop();if(S!==C){b[0]=S;e:for(var O=0,j=b.length,B=j>>>1;O<B;){var A=2*(O+1)-1,K=b[A],H=A+1,te=b[H];if(0>d(K,S))H<j&&0>d(te,K)?(b[O]=te,b[H]=S,O=H):(b[O]=K,b[A]=S,O=A);else if(H<j&&0>d(te,S))b[O]=te,b[H]=S,O=H;else break e}}return C}function d(b,C){var S=b.sortIndex-C.sortIndex;return S!==0?S:b.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;e.unstable_now=function(){return m.now()}}else{var y=Date,g=y.now();e.unstable_now=function(){return y.now()-g}}var a=[],p=[],t=1,r=null,i=3,u=!1,f=!1,_=!1,h=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,l=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(b){for(var C=o(p);C!==null;){if(C.callback===null)c(p);else if(C.startTime<=b)c(p),C.sortIndex=C.expirationTime,n(a,C);else break;C=o(p)}}function E(b){if(_=!1,v(b),!f)if(o(a)!==null)f=!0,N(R);else{var C=o(p);C!==null&&F(E,C.startTime-b)}}function R(b,C){f=!1,_&&(_=!1,s(D),D=-1),u=!0;var S=i;try{for(v(C),r=o(a);r!==null&&(!(r.expirationTime>C)||b&&!w());){var O=r.callback;if(typeof O=="function"){r.callback=null,i=r.priorityLevel;var j=O(r.expirationTime<=C);C=e.unstable_now(),typeof j=="function"?r.callback=j:r===o(a)&&c(a),v(C)}else c(a);r=o(a)}if(r!==null)var B=!0;else{var A=o(p);A!==null&&F(E,A.startTime-C),B=!1}return B}finally{r=null,i=S,u=!1}}var M=!1,T=null,D=-1,I=5,x=-1;function w(){return!(e.unstable_now()-x<I)}function k(){if(T!==null){var b=e.unstable_now();x=b;var C=!0;try{C=T(!0,b)}finally{C?z():(M=!1,T=null)}}else M=!1}var z;if(typeof l=="function")z=function(){l(k)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,U=G.port2;G.port1.onmessage=k,z=function(){U.postMessage(null)}}else z=function(){h(k,0)};function N(b){T=b,M||(M=!0,z())}function F(b,C){D=h(function(){b(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){f||u||(f=!0,N(R))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return i},e.unstable_getFirstCallbackNode=function(){return o(a)},e.unstable_next=function(b){switch(i){case 1:case 2:case 3:var C=3;break;default:C=i}var S=i;i=C;try{return b()}finally{i=S}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,C){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var S=i;i=b;try{return C()}finally{i=S}},e.unstable_scheduleCallback=function(b,C,S){var O=e.unstable_now();switch(typeof S=="object"&&S!==null?(S=S.delay,S=typeof S=="number"&&0<S?O+S:O):S=O,b){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=S+j,b={id:t++,callback:C,priorityLevel:b,startTime:S,expirationTime:j,sortIndex:-1},S>O?(b.sortIndex=S,n(p,b),o(a)===null&&b===o(p)&&(_?(s(D),D=-1):_=!0,F(E,S-O))):(b.sortIndex=j,n(a,b),f||u||(f=!0,N(R))),b},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(b){var C=i;return function(){var S=i;i=C;try{return b.apply(this,arguments)}finally{i=S}}}})(ke);je.exports=ke;var ye=je.exports;const ge={},mt=e=>void Object.assign(ge,e);function gt(e,n){function o(t,{args:r=[],attach:i,...u},f){let _=`${t[0].toUpperCase()}${t.slice(1)}`,h;if(t==="primitive"){if(u.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=u.object;h=W(s,{type:t,root:f,attach:i,primitive:!0})}else{const s=ge[_];if(!s)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");h=W(new s(...r),{type:t,root:f,attach:i,memoizedProps:{args:r}})}return h.__r3f.attach===void 0&&(h instanceof Ve?h.__r3f.attach="geometry":h instanceof Xe&&(h.__r3f.attach="material")),_!=="inject"&&le(h,u),h}function c(t,r){let i=!1;if(r){var u,f;(u=r.__r3f)!=null&&u.attach?ce(t,r,r.__r3f.attach):r.isObject3D&&t.isObject3D&&(t.add(r),i=!0),i||(f=t.__r3f)==null||f.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=t,me(r),V(r)}}function d(t,r,i){let u=!1;if(r){var f,_;if((f=r.__r3f)!=null&&f.attach)ce(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){r.parent=t,r.dispatchEvent({type:"added"});const h=t.children.filter(l=>l!==r),s=h.indexOf(i);t.children=[...h.slice(0,s),r,...h.slice(s)],u=!0}u||(_=t.__r3f)==null||_.objects.push(r),r.__r3f||W(r,{}),r.__r3f.parent=t,me(r),V(r)}}function m(t,r,i=!1){t&&[...t].forEach(u=>y(r,u,i))}function y(t,r,i){if(r){var u,f,_;if(r.__r3f&&(r.__r3f.parent=null),(u=t.__r3f)!=null&&u.objects&&(t.__r3f.objects=t.__r3f.objects.filter(E=>E!==r)),(f=r.__r3f)!=null&&f.attach)Pe(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){var h;t.remove(r),(h=r.__r3f)!=null&&h.root&&Et(r.__r3f.root,r)}const l=(_=r.__r3f)==null?void 0:_.primitive,v=i===void 0?r.dispose!==null&&!l:i;if(!l){var s;m((s=r.__r3f)==null?void 0:s.objects,r,v),m(r.children,r,v)}delete r.__r3f,v&&r.dispose&&r.type!=="Scene"&&ye.unstable_scheduleCallback(ye.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),V(t)}}function g(t,r,i,u){var f;const _=(f=t.__r3f)==null?void 0:f.parent;if(!_)return;const h=o(r,i,t.__r3f.root);if(t.children){for(const s of t.children)s.__r3f&&c(h,s);t.children=t.children.filter(s=>!s.__r3f)}t.__r3f.objects.forEach(s=>c(h,s)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||y(_,t),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),c(_,h),h.raycast&&h.__r3f.eventCount&&h.__r3f.root.getState().internal.interaction.push(h),[u,u.alternate].forEach(s=>{s!==null&&(s.stateNode=h,s.ref&&(typeof s.ref=="function"?s.ref(h):s.ref.current=h))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:lt({createInstance:o,removeChild:y,appendChild:c,appendInitialChild:c,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,r)=>{if(!r)return;const i=t.getState().scene;i.__r3f&&(i.__r3f.root=t,c(i,r))},removeChildFromContainer:(t,r)=>{r&&y(t.getState().scene,r)},insertInContainerBefore:(t,r,i)=>{if(!r||!i)return;const u=t.getState().scene;u.__r3f&&d(u,r,i)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var r;return!!((r=t==null?void 0:t.__r3f)!=null?r:{}).handlers},prepareUpdate(t,r,i,u){var f;if(((f=t==null?void 0:t.__r3f)!=null?f:{}).primitive&&u.object&&u.object!==t)return[!0];{const{args:h=[],children:s,...l}=u,{args:v=[],children:E,...R}=i;if(!Array.isArray(h))throw new Error("R3F: the args prop must be an array!");if(h.some((T,D)=>T!==v[D]))return[!0];const M=ze(t,l,R,!0);return M.changes.length?[!1,M]:null}},commitUpdate(t,[r,i],u,f,_,h){r?g(t,u,_,h):le(t,i)},commitMount(t,r,i,u){var f;const _=(f=t.__r3f)!=null?f:{};t.raycast&&_.handlers&&_.eventCount&&t.__r3f.root.getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>W(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var r;const{attach:i,parent:u}=(r=t.__r3f)!=null?r:{};i&&u&&Pe(u,t,i),t.isObject3D&&(t.visible=!1),V(t)},unhideInstance(t,r){var i;const{attach:u,parent:f}=(i=t.__r3f)!=null?i:{};u&&f&&ce(f,t,u),(t.isObject3D&&r.visible==null||r.visible)&&(t.visible=!0),V(t)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>n?n():X.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:le}}var we,Se;const ae=e=>"colorSpace"in e||"outputColorSpace"in e,Te=()=>{var e;return(e=ge.ColorManagement)!=null?e:null},xe=e=>e&&e.isOrthographicCamera,bt=e=>e&&e.hasOwnProperty("current"),ee=typeof window<"u"&&((we=window.document)!=null&&we.createElement||((Se=window.navigator)==null?void 0:Se.product)==="ReactNative")?P.useLayoutEffect:P.useEffect;function De(e){const n=P.useRef(e);return ee(()=>void(n.current=e),[e]),n}function _t({set:e}){return ee(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ae extends P.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}}Ae.getDerivedStateFromError=()=>({error:!0});const Le="__default",Ce=new Map,yt=e=>e&&!!e.memoized&&!!e.changes;function Ie(e){var n;const o=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const J=e=>{var n;return(n=e.__r3f)==null?void 0:n.root.getState()},L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,n,{arrays:o="shallow",objects:c="reference",strict:d=!0}={}){if(typeof e!=typeof n||!!e!=!!n)return!1;if(L.str(e)||L.num(e))return e===n;const m=L.obj(e);if(m&&c==="reference")return e===n;const y=L.arr(e);if(y&&o==="reference")return e===n;if((y||m)&&e===n)return!0;let g;for(g in e)if(!(g in n))return!1;if(m&&o==="shallow"&&c==="shallow"){for(g in d?n:e)if(!L.equ(e[g],n[g],{strict:d,objects:"reference"}))return!1}else for(g in d?n:e)if(e[g]!==n[g])return!1;if(L.und(g)){if(y&&e.length===0&&n.length===0||m&&Object.keys(e).length===0&&Object.keys(n).length===0)return!0;if(e!==n)return!1}return!0}};function wt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const n in e)n.dispose==null||n.dispose(),delete e[n]}function W(e,n){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...n},e}function he(e,n){let o=e;if(n.includes("-")){const c=n.split("-"),d=c.pop();return o=c.reduce((m,y)=>m[y],e),{target:o,key:d}}else return{target:o,key:n}}const Ee=/-\d+$/;function ce(e,n,o){if(L.str(o)){if(Ee.test(o)){const m=o.replace(Ee,""),{target:y,key:g}=he(e,m);Array.isArray(y[g])||(y[g]=[])}const{target:c,key:d}=he(e,o);n.__r3f.previousAttach=c[d],c[d]=n}else n.__r3f.previousAttach=o(e,n)}function Pe(e,n,o){var c,d;if(L.str(o)){const{target:m,key:y}=he(e,o),g=n.__r3f.previousAttach;g===void 0?delete m[y]:m[y]=g}else(c=n.__r3f)==null||c.previousAttach==null||c.previousAttach(e,n);(d=n.__r3f)==null||delete d.previousAttach}function ze(e,{children:n,key:o,ref:c,...d},{children:m,key:y,ref:g,...a}={},p=!1){var t;const r=(t=e==null?void 0:e.__r3f)!=null?t:{},i=Object.entries(d),u=[];if(p){const _=Object.keys(a);for(let h=0;h<_.length;h++)d.hasOwnProperty(_[h])||i.unshift([_[h],Le+"remove"])}i.forEach(([_,h])=>{var s;if((s=e.__r3f)!=null&&s.primitive&&_==="object"||L.equ(h,a[_]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return u.push([_,h,!0,[]]);let l=[];_.includes("-")&&(l=_.split("-")),u.push([_,h,!1,l]);for(const v in d){const E=d[v];v.startsWith(`${_}-`)&&u.push([v,E,!1,v.split("-")])}});const f={...d};return r.memoizedProps&&r.memoizedProps.args&&(f.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(f.attach=r.memoizedProps.attach),{memoized:f,changes:u}}function le(e,n){var o,c,d;const m=(o=e.__r3f)!=null?o:{},y=m.root,g=(c=y==null||y.getState==null?void 0:y.getState())!=null?c:{},{memoized:a,changes:p}=yt(n)?n:ze(e,n),t=m.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let i=0;i<p.length;i++){let[u,f,_,h]=p[i];if(ae(e)){const E="srgb",R="srgb-linear";u==="encoding"?(u="colorSpace",f=f===3001?E:R):u==="outputEncoding"&&(u="outputColorSpace",f=f===3001?E:R)}let s=e,l=s[u];if(h.length&&(l=h.reduce((v,E)=>v[E],e),!(l&&l.set))){const[v,...E]=h.reverse();s=E.reverse().reduce((R,M)=>R[M],e),u=v}if(f===Le+"remove")if(s.constructor){let v=Ce.get(s.constructor);v||(v=new s.constructor,Ce.set(s.constructor,v)),f=v[u]}else f=0;if(_)f?m.handlers[u]=f:delete m.handlers[u],m.eventCount=Object.keys(m.handlers).length;else if(l&&l.set&&(l.copy||l instanceof ie)){if(Array.isArray(f))l.fromArray?l.fromArray(f):l.set(...f);else if(l.copy&&f&&f.constructor&&l.constructor===f.constructor)l.copy(f);else if(f!==void 0){const v=l instanceof Ye;!v&&l.setScalar?l.setScalar(f):l instanceof ie&&f instanceof ie?l.mask=f.mask:l.set(f),!Te()&&!g.linear&&v&&l.convertSRGBToLinear()}}else if(s[u]=f,s[u]instanceof $e&&s[u].format===qe&&s[u].type===We){const v=s[u];ae(v)&&ae(g.gl)?v.colorSpace=g.gl.outputColorSpace:v.encoding=g.gl.outputEncoding}V(e)}if(m.parent&&g.internal&&e.raycast&&t!==m.eventCount){const i=g.internal.interaction.indexOf(e);i>-1&&g.internal.interaction.splice(i,1),m.eventCount&&g.internal.interaction.push(e)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(d=e.__r3f)!=null&&d.parent&&me(e),e}function V(e){var n,o;const c=(n=e.__r3f)==null||(o=n.root)==null||o.getState==null?void 0:o.getState();c&&c.internal.frames===0&&c.invalidate()}function me(e){e.onUpdate==null||e.onUpdate(e)}function St(e,n){e.manual||(xe(e)?(e.left=n.width/-2,e.right=n.width/2,e.top=n.height/2,e.bottom=n.height/-2):e.aspect=n.width/n.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ne(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ct(){var e;const n=typeof self<"u"&&self||typeof window<"u"&&window;if(!n)return X.DefaultEventPriority;switch((e=n.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return X.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return X.ContinuousEventPriority;default:return X.DefaultEventPriority}}function Fe(e,n,o,c){const d=o.get(n);d&&(o.delete(n),o.size===0&&(e.delete(c),d.target.releasePointerCapture(c)))}function Et(e,n){const{internal:o}=e.getState();o.interaction=o.interaction.filter(c=>c!==n),o.initialHits=o.initialHits.filter(c=>c!==n),o.hovered.forEach((c,d)=>{(c.eventObject===n||c.object===n)&&o.hovered.delete(d)}),o.capturedMap.forEach((c,d)=>{Fe(o.capturedMap,n,c,d)})}function Pt(e){function n(a){const{internal:p}=e.getState(),t=a.offsetX-p.initialClick[0],r=a.offsetY-p.initialClick[1];return Math.round(Math.sqrt(t*t+r*r))}function o(a){return a.filter(p=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return(r=p.__r3f)==null?void 0:r.handlers["onPointer"+t]}))}function c(a,p){const t=e.getState(),r=new Set,i=[],u=p?p(t.internal.interaction):t.internal.interaction;for(let s=0;s<u.length;s++){const l=J(u[s]);l&&(l.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(a,t);function f(s){const l=J(s);if(!l||!l.events.enabled||l.raycaster.camera===null)return[];if(l.raycaster.camera===void 0){var v;l.events.compute==null||l.events.compute(a,l,(v=l.previousRoot)==null?void 0:v.getState()),l.raycaster.camera===void 0&&(l.raycaster.camera=null)}return l.raycaster.camera?l.raycaster.intersectObject(s,!0):[]}let _=u.flatMap(f).sort((s,l)=>{const v=J(s.object),E=J(l.object);return!v||!E?s.distance-l.distance:E.events.priority-v.events.priority||s.distance-l.distance}).filter(s=>{const l=ne(s);return r.has(l)?!1:(r.add(l),!0)});t.events.filter&&(_=t.events.filter(_,t));for(const s of _){let l=s.object;for(;l;){var h;(h=l.__r3f)!=null&&h.eventCount&&i.push({...s,eventObject:l}),l=l.parent}}if("pointerId"in a&&t.internal.capturedMap.has(a.pointerId))for(let s of t.internal.capturedMap.get(a.pointerId).values())r.has(ne(s.intersection))||i.push(s.intersection);return i}function d(a,p,t,r){const i=e.getState();if(a.length){const u={stopped:!1};for(const f of a){const _=J(f.object)||i,{raycaster:h,pointer:s,camera:l,internal:v}=_,E=new Z(s.x,s.y,0).unproject(l),R=x=>{var w,k;return(w=(k=v.capturedMap.get(x))==null?void 0:k.has(f.eventObject))!=null?w:!1},M=x=>{const w={intersection:f,target:p.target};v.capturedMap.has(x)?v.capturedMap.get(x).set(f.eventObject,w):v.capturedMap.set(x,new Map([[f.eventObject,w]])),p.target.setPointerCapture(x)},T=x=>{const w=v.capturedMap.get(x);w&&Fe(v.capturedMap,f.eventObject,w,x)};let D={};for(let x in p){let w=p[x];typeof w!="function"&&(D[x]=w)}let I={...f,...D,pointer:s,intersections:a,stopped:u.stopped,delta:t,unprojectedPoint:E,ray:h.ray,camera:l,stopPropagation(){const x="pointerId"in p&&v.capturedMap.get(p.pointerId);if((!x||x.has(f.eventObject))&&(I.stopped=u.stopped=!0,v.hovered.size&&Array.from(v.hovered.values()).find(w=>w.eventObject===f.eventObject))){const w=a.slice(0,a.indexOf(f));m([...w,f])}},target:{hasPointerCapture:R,setPointerCapture:M,releasePointerCapture:T},currentTarget:{hasPointerCapture:R,setPointerCapture:M,releasePointerCapture:T},nativeEvent:p};if(r(I),u.stopped===!0)break}}return a}function m(a){const{internal:p}=e.getState();for(const t of p.hovered.values())if(!a.length||!a.find(r=>r.object===t.object&&r.index===t.index&&r.instanceId===t.instanceId)){const i=t.eventObject.__r3f,u=i==null?void 0:i.handlers;if(p.hovered.delete(ne(t)),i!=null&&i.eventCount){const f={...t,intersections:a};u.onPointerOut==null||u.onPointerOut(f),u.onPointerLeave==null||u.onPointerLeave(f)}}}function y(a,p){for(let t=0;t<p.length;t++){const r=p[t].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(a)}}function g(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>m([]);case"onLostPointerCapture":return p=>{const{internal:t}=e.getState();"pointerId"in p&&t.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(p.pointerId)&&(t.capturedMap.delete(p.pointerId),m([]))})}}return function(t){const{onPointerMissed:r,internal:i}=e.getState();i.lastEvent.current=t;const u=a==="onPointerMove",f=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",h=c(t,u?o:void 0),s=f?n(t):0;a==="onPointerDown"&&(i.initialClick=[t.offsetX,t.offsetY],i.initialHits=h.map(v=>v.eventObject)),f&&!h.length&&s<=2&&(y(t,i.interaction),r&&r(t)),u&&m(h);function l(v){const E=v.eventObject,R=E.__r3f,M=R==null?void 0:R.handlers;if(R!=null&&R.eventCount)if(u){if(M.onPointerOver||M.onPointerEnter||M.onPointerOut||M.onPointerLeave){const T=ne(v),D=i.hovered.get(T);D?D.stopped&&v.stopPropagation():(i.hovered.set(T,v),M.onPointerOver==null||M.onPointerOver(v),M.onPointerEnter==null||M.onPointerEnter(v))}M.onPointerMove==null||M.onPointerMove(v)}else{const T=M[a];T?(!f||i.initialHits.includes(E))&&(y(t,i.interaction.filter(D=>!i.initialHits.includes(D))),T(v)):f&&i.initialHits.includes(E)&&y(t,i.interaction.filter(D=>!i.initialHits.includes(D)))}}d(h,t,s,l)}}return{handlePointer:g}}const Be=e=>!!(e!=null&&e.render),He=P.createContext(null),Mt=(e,n)=>{const o=ht((g,a)=>{const p=new Z,t=new Z,r=new Z;function i(s=a().camera,l=t,v=a().size){const{width:E,height:R,top:M,left:T}=v,D=E/R;l instanceof Z?r.copy(l):r.set(...l);const I=s.getWorldPosition(p).distanceTo(r);if(xe(s))return{width:E/s.zoom,height:R/s.zoom,top:M,left:T,factor:1,distance:I,aspect:D};{const x=s.fov*Math.PI/180,w=2*Math.tan(x/2)*I,k=w*(E/R);return{width:k,height:w,top:M,left:T,factor:E/k,distance:I,aspect:D}}}let u;const f=s=>g(l=>({performance:{...l.performance,current:s}})),_=new st;return{set:g,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(a(),s),advance:(s,l)=>n(s,l,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new at,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=a();u&&clearTimeout(u),s.performance.current!==s.performance.min&&f(s.performance.min),u=setTimeout(()=>f(a().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:i},setEvents:s=>g(l=>({...l,events:{...l.events,...s}})),setSize:(s,l,v,E,R)=>{const M=a().camera,T={width:s,height:l,top:E||0,left:R||0,updateStyle:v};g(D=>({size:T,viewport:{...D.viewport,...i(M,t,T)}}))},setDpr:s=>g(l=>{const v=Ie(s);return{viewport:{...l.viewport,dpr:v,initialDpr:l.viewport.initialDpr||v}}}),setFrameloop:(s="always")=>{const l=a().clock;l.stop(),l.elapsedTime=0,s!=="never"&&(l.start(),l.elapsedTime=0),g(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:P.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,l,v)=>{const E=a().internal;return E.priority=E.priority+(l>0?1:0),E.subscribers.push({ref:s,priority:l,store:v}),E.subscribers=E.subscribers.sort((R,M)=>R.priority-M.priority),()=>{const R=a().internal;R!=null&&R.subscribers&&(R.priority=R.priority-(l>0?1:0),R.subscribers=R.subscribers.filter(M=>M.ref!==s))}}}}}),c=o.getState();let d=c.size,m=c.viewport.dpr,y=c.camera;return o.subscribe(()=>{const{camera:g,size:a,viewport:p,gl:t,set:r}=o.getState();if(a!==d||p.dpr!==m){var i;d=a,m=p.dpr,St(g,a),t.setPixelRatio(p.dpr);const u=(i=a.updateStyle)!=null?i:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(a.width,a.height,u)}g!==y&&(y=g,r(u=>({viewport:{...u.viewport,...u.viewport.getCurrentViewport(g)}})))}),o.subscribe(g=>e(g)),o};function Rt(e,n){const o={callback:e};return n.add(o),()=>void n.delete(o)}let re,Ne=new Set,Ot=new Set,jt=new Set;const qt=e=>Rt(e,Ne);function ue(e,n){if(e.size)for(const{callback:o}of e.values())o(n)}function Q(e,n){switch(e){case"before":return ue(Ne,n);case"after":return ue(Ot,n);case"tail":return ue(jt,n)}}let fe,de;function pe(e,n,o){let c=n.clock.getDelta();for(n.frameloop==="never"&&typeof e=="number"&&(c=e-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=e),fe=n.internal.subscribers,re=0;re<fe.length;re++)de=fe[re],de.ref.current(de.store.getState(),c,o);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}function kt(e){let n=!1,o,c,d;function m(a){c=requestAnimationFrame(m),n=!0,o=0,Q("before",a);for(const t of e.values()){var p;d=t.store.getState(),d.internal.active&&(d.frameloop==="always"||d.internal.frames>0)&&!((p=d.gl.xr)!=null&&p.isPresenting)&&(o+=pe(a,d))}if(Q("after",a),o===0)return Q("tail",a),n=!1,cancelAnimationFrame(c)}function y(a,p=1){var t;if(!a)return e.forEach(r=>y(r.store.getState()),p);(t=a.gl.xr)!=null&&t.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+p),n||(n=!0,requestAnimationFrame(m)))}function g(a,p=!0,t,r){if(p&&Q("before",a),t)pe(a,t,r);else for(const i of e.values())pe(a,i.store.getState());p&&Q("after",a)}return{loop:m,invalidate:y,advance:g}}function Ge(){const e=P.useContext(He);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Wt(e=o=>o,n){return Ge()(e,n)}function Vt(e,n=0){const o=Ge(),c=o.getState().internal.subscribe,d=De(e);return ee(()=>c(d,n,o),[n,c,o]),null}const Y=new Map,{invalidate:Me,advance:Re}=kt(Y),{reconciler:oe,applyProps:$}=gt(Y,Ct),q={objects:"shallow",strict:!1},Tt=(e,n)=>{const o=typeof e=="function"?e(n):e;return Be(o)?o:new tt({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...e})};function xt(e,n){if(n)return n;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:c,top:d,left:m}=e.parentElement.getBoundingClientRect();return{width:o,height:c,top:d,left:m}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Dt(e){const n=Y.get(e),o=n==null?void 0:n.fiber,c=n==null?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,m=c||Mt(Me,Re),y=o||oe.createContainer(m,X.ConcurrentRoot,null,!1,null,"",d,null);n||Y.set(e,{fiber:y,store:m});let g,a=!1,p;return{configure(t={}){let{gl:r,size:i,scene:u,events:f,onCreated:_,shadows:h=!1,linear:s=!1,flat:l=!1,legacy:v=!1,orthographic:E=!1,frameloop:R="always",dpr:M=[1,2],performance:T,raycaster:D,camera:I,onPointerMissed:x}=t,w=m.getState(),k=w.gl;w.gl||w.set({gl:k=Tt(r,e)});let z=w.raycaster;z||w.set({raycaster:z=new Ke});const{params:G,...U}=D||{};if(L.equ(U,z,q)||$(z,{...U}),L.equ(G,z.params,q)||$(z,{params:{...z.params,...G}}),!w.camera||w.camera===p&&!L.equ(p,I,q)){p=I;const O=I instanceof nt,j=O?I:E?new Je(0,0,0,0,.1,1e3):new Qe(75,0,.1,1e3);O||(j.position.z=5,I&&$(j,I),!w.camera&&!(I!=null&&I.rotation)&&j.lookAt(0,0,0)),w.set({camera:j})}if(!w.scene){let O;u instanceof be?O=u:(O=new be,u&&$(O,u)),w.set({scene:W(O)})}if(!w.xr){const O=(A,K)=>{const H=m.getState();H.frameloop!=="never"&&Re(A,!0,H,K)},j=()=>{const A=m.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?O:null),A.gl.xr.isPresenting||Me(A)},B={connect(){const A=m.getState().gl;A.xr.addEventListener("sessionstart",j),A.xr.addEventListener("sessionend",j)},disconnect(){const A=m.getState().gl;A.xr.removeEventListener("sessionstart",j),A.xr.removeEventListener("sessionend",j)}};k.xr&&B.connect(),w.set({xr:B})}if(k.shadowMap){const O=k.shadowMap.enabled,j=k.shadowMap.type;if(k.shadowMap.enabled=!!h,L.boo(h))k.shadowMap.type=se;else if(L.str(h)){var N;const B={basic:rt,percentage:ot,soft:se,variance:it};k.shadowMap.type=(N=B[h])!=null?N:se}else L.obj(h)&&Object.assign(k.shadowMap,h);(O!==k.shadowMap.enabled||j!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}const F=Te();F&&("enabled"in F?F.enabled=!v:"legacyMode"in F&&(F.legacyMode=v)),$(k,{outputEncoding:s?3e3:3001,toneMapping:l?Ze:et}),w.legacy!==v&&w.set(()=>({legacy:v})),w.linear!==s&&w.set(()=>({linear:s})),w.flat!==l&&w.set(()=>({flat:l})),r&&!L.fun(r)&&!Be(r)&&!L.equ(r,k,q)&&$(k,r),f&&!w.events.handlers&&w.set({events:f(m)});const S=xt(e,i);return L.equ(S,w.size,q)||w.setSize(S.width,S.height,S.updateStyle,S.top,S.left),M&&w.viewport.dpr!==Ie(M)&&w.setDpr(M),w.frameloop!==R&&w.setFrameloop(R),w.onPointerMissed||w.set({onPointerMissed:x}),T&&!L.equ(T,w.performance,q)&&w.set(O=>({performance:{...O.performance,...T}})),g=_,a=!0,this},render(t){return a||this.configure(),oe.updateContainer(P.createElement(At,{store:m,children:t,onCreated:g,rootElement:e}),y,null,()=>{}),m},unmount(){Ue(e)}}}function At({store:e,children:n,onCreated:o,rootElement:c}){return ee(()=>{const d=e.getState();d.set(m=>({internal:{...m.internal,active:!0}})),o&&o(d),e.getState().events.connected||d.events.connect==null||d.events.connect(c)},[]),P.createElement(He.Provider,{value:e},n)}function Ue(e,n){const o=Y.get(e),c=o==null?void 0:o.fiber;if(c){const d=o==null?void 0:o.store.getState();d&&(d.internal.active=!1),oe.updateContainer(null,c,null,()=>{d&&setTimeout(()=>{try{var m,y,g,a;d.events.disconnect==null||d.events.disconnect(),(m=d.gl)==null||(y=m.renderLists)==null||y.dispose==null||y.dispose(),(g=d.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(a=d.gl)!=null&&a.xr&&d.xr.disconnect(),wt(d),Y.delete(e)}catch{}},500)})}}oe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:P.version});const ve={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Lt(e){const{handlePointer:n}=Pt(e);return{priority:1,enabled:!0,compute(o,c,d){c.pointer.set(o.offsetX/c.size.width*2-1,-(o.offsetY/c.size.height)*2+1),c.raycaster.setFromCamera(c.pointer,c.camera)},connected:void 0,handlers:Object.keys(ve).reduce((o,c)=>({...o,[c]:n(c)}),{}),update:()=>{var o;const{events:c,internal:d}=e.getState();(o=d.lastEvent)!=null&&o.current&&c.handlers&&c.handlers.onPointerMove(d.lastEvent.current)},connect:o=>{var c;const{set:d,events:m}=e.getState();m.disconnect==null||m.disconnect(),d(y=>({events:{...y.events,connected:o}})),Object.entries((c=m.handlers)!=null?c:[]).forEach(([y,g])=>{const[a,p]=ve[y];o.addEventListener(a,g,{passive:p})})},disconnect:()=>{const{set:o,events:c}=e.getState();if(c.connected){var d;Object.entries((d=c.handlers)!=null?d:[]).forEach(([m,y])=>{if(c&&c.connected instanceof HTMLElement){const[g]=ve[m];c.connected.removeEventListener(g,y)}}),o(m=>({events:{...m.events,connected:void 0}}))}}}}const It=P.forwardRef(function({children:n,fallback:o,resize:c,style:d,gl:m,events:y=Lt,eventSource:g,eventPrefix:a,shadows:p,linear:t,flat:r,legacy:i,orthographic:u,frameloop:f,dpr:_,performance:h,raycaster:s,camera:l,onPointerMissed:v,onCreated:E,...R},M){P.useMemo(()=>mt(ct),[]);const T=dt(),[D,I]=ut({scroll:!0,debounce:{scroll:50,resize:0},...c}),x=P.useRef(null),w=P.useRef(null);P.useImperativeHandle(M,()=>x.current);const k=De(v),[z,G]=P.useState(!1),[U,N]=P.useState(!1);if(z)throw z;if(U)throw U;const F=P.useRef(null);ee(()=>{const C=x.current;I.width>0&&I.height>0&&C&&(F.current||(F.current=Dt(C)),F.current.configure({gl:m,events:y,shadows:p,linear:t,flat:r,legacy:i,orthographic:u,frameloop:f,dpr:_,performance:h,raycaster:s,camera:l,size:I,onPointerMissed:(...S)=>k.current==null?void 0:k.current(...S),onCreated:S=>{S.events.connect==null||S.events.connect(g?bt(g)?g.current:g:w.current),a&&S.setEvents({compute:(O,j)=>{const B=O[a+"X"],A=O[a+"Y"];j.pointer.set(B/j.size.width*2-1,-(A/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),E==null||E(S)}}),F.current.render(P.createElement(T,null,P.createElement(Ae,{set:N},P.createElement(P.Suspense,{fallback:P.createElement(_t,{set:G})},n)))))}),P.useEffect(()=>{const C=x.current;if(C)return()=>Ue(C)},[]);const b=g?"none":"auto";return P.createElement("div",Oe({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:b,...d}},R),P.createElement("div",{ref:D,style:{width:"100%",height:"100%"}},P.createElement("canvas",{ref:x,style:{display:"block"}},o)))}),Xt=P.forwardRef(function(n,o){return P.createElement(ft,null,P.createElement(It,Oe({},n,{ref:o})))});export{Xt as C,qt as a,$ as b,Vt as c,Ut as d,mt as e,$t as g,Wt as u};
