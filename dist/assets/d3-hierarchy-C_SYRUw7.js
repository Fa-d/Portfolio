function O(n){var e=0,r=n.children,i=r&&r.length;if(!i)e=1;else for(;--i>=0;)e+=r[i].value;n.value=e}function P(){return this.eachAfter(O)}function j(n,e){let r=-1;for(const i of this)n.call(e,i,++r,this);return this}function D(n,e){for(var r=this,i=[r],a,l,h=-1;r=i.pop();)if(n.call(e,r,++h,this),a=r.children)for(l=a.length-1;l>=0;--l)i.push(a[l]);return this}function K(n,e){for(var r=this,i=[r],a=[],l,h,p,y=-1;r=i.pop();)if(a.push(r),l=r.children)for(h=0,p=l.length;h<p;++h)i.push(l[h]);for(;r=a.pop();)n.call(e,r,++y,this);return this}function W(n,e){let r=-1;for(const i of this)if(n.call(e,i,++r,this))return i}function $(n){return this.eachAfter(function(e){for(var r=+n(e.data)||0,i=e.children,a=i&&i.length;--a>=0;)r+=i[a].value;e.value=r})}function H(n){return this.eachBefore(function(e){e.children&&e.children.sort(n)})}function Z(n){for(var e=this,r=v(e,n),i=[e];e!==r;)e=e.parent,i.push(e);for(var a=i.length;n!==r;)i.splice(a,0,n),n=n.parent;return i}function v(n,e){if(n===e)return n;var r=n.ancestors(),i=e.ancestors(),a=null;for(n=r.pop(),e=i.pop();n===e;)a=n,n=r.pop(),e=i.pop();return a}function F(){for(var n=this,e=[n];n=n.parent;)e.push(n);return e}function G(){return Array.from(this)}function J(){var n=[];return this.eachBefore(function(e){e.children||n.push(e)}),n}function Q(){var n=this,e=[];return n.each(function(r){r!==n&&e.push({source:r.parent,target:r})}),e}function*U(){var n=this,e,r=[n],i,a,l;do for(e=r.reverse(),r=[];n=e.pop();)if(yield n,i=n.children)for(a=0,l=i.length;a<l;++a)r.push(i[a]);while(r.length)}function L(n,e){n instanceof Map?(n=[void 0,n],e===void 0&&(e=nn)):e===void 0&&(e=Y);for(var r=new A(n),i,a=[r],l,h,p,y;i=a.pop();)if((h=e(i.data))&&(y=(h=Array.from(h)).length))for(i.children=h,p=y-1;p>=0;--p)a.push(l=h[p]=new A(h[p])),l.parent=i,l.depth=i.depth+1;return r.eachBefore(V)}function X(){return L(this).eachBefore(en)}function Y(n){return n.children}function nn(n){return Array.isArray(n)?n[1]:null}function en(n){n.data.value!==void 0&&(n.value=n.data.value),n.data=n.data.data}function V(n){var e=0;do n.height=e;while((n=n.parent)&&n.height<++e)}function A(n){this.data=n,this.depth=this.height=0,this.parent=null}A.prototype=L.prototype={constructor:A,count:P,each:j,eachAfter:K,eachBefore:D,find:W,sum:$,sort:H,path:Z,ancestors:F,descendants:G,leaves:J,links:Q,copy:X,[Symbol.iterator]:U};function S(n){return n==null?null:C(n)}function C(n){if(typeof n!="function")throw new Error;return n}function k(){return 0}function I(n){return function(){return n}}function tn(n){n.x0=Math.round(n.x0),n.y0=Math.round(n.y0),n.x1=Math.round(n.x1),n.y1=Math.round(n.y1)}function rn(n,e,r,i,a){for(var l=n.children,h,p=-1,y=l.length,u=n.value&&(i-e)/n.value;++p<y;)h=l[p],h.y0=r,h.y1=a,h.x0=e,h.x1=e+=h.value*u}var un={depth:-1},q={},R={};function an(n){return n.id}function ln(n){return n.parentId}function wn(){var n=an,e=ln,r;function i(a){var l=Array.from(a),h=n,p=e,y,u,c,s,t,o,f,m,d=new Map;if(r!=null){const g=l.map((_,B)=>cn(r(_,B,a))),w=g.map(T),z=new Set(g).add("");for(const _ of w)z.has(_)||(z.add(_),g.push(_),w.push(T(_)),l.push(R));h=(_,B)=>g[B],p=(_,B)=>w[B]}for(c=0,y=l.length;c<y;++c)u=l[c],o=l[c]=new A(u),(f=h(u,c,a))!=null&&(f+="")&&(m=o.id=f,d.set(m,d.has(m)?q:o)),(f=p(u,c,a))!=null&&(f+="")&&(o.parent=f);for(c=0;c<y;++c)if(o=l[c],f=o.parent){if(t=d.get(f),!t)throw new Error("missing: "+f);if(t===q)throw new Error("ambiguous: "+f);t.children?t.children.push(o):t.children=[o],o.parent=t}else{if(s)throw new Error("multiple roots");s=o}if(!s)throw new Error("no root");if(r!=null){for(;s.data===R&&s.children.length===1;)s=s.children[0],--y;for(let g=l.length-1;g>=0&&(o=l[g],o.data===R);--g)o.data=null}if(s.parent=un,s.eachBefore(function(g){g.depth=g.parent.depth+1,--y}).eachBefore(V),s.parent=null,y>0)throw new Error("cycle");return s}return i.id=function(a){return arguments.length?(n=S(a),i):n},i.parentId=function(a){return arguments.length?(e=S(a),i):e},i.path=function(a){return arguments.length?(r=S(a),i):r},i}function cn(n){n=`${n}`;let e=n.length;return E(n,e-1)&&!E(n,e-2)&&(n=n.slice(0,-1)),n[0]==="/"?n:`/${n}`}function T(n){let e=n.length;if(e<2)return"";for(;--e>1&&!E(n,e););return n.slice(0,e)}function E(n,e){if(n[e]==="/"){let r=0;for(;e>0&&n[--e]==="\\";)++r;if(!(r&1))return!0}return!1}function hn(n,e){return n.parent===e.parent?1:2}function N(n){var e=n.children;return e?e[0]:n.t}function b(n){var e=n.children;return e?e[e.length-1]:n.t}function on(n,e,r){var i=r/(e.i-n.i);e.c-=i,e.s+=r,n.c+=i,e.z+=r,e.m+=r}function fn(n){for(var e=0,r=0,i=n.children,a=i.length,l;--a>=0;)l=i[a],l.z+=e,l.m+=e,e+=l.s+(r+=l.c)}function sn(n,e,r){return n.a.parent===e.parent?n.a:r}function M(n,e){this._=n,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}M.prototype=Object.create(A.prototype);function dn(n){for(var e=new M(n,0),r,i=[e],a,l,h,p;r=i.pop();)if(l=r._.children)for(r.children=new Array(p=l.length),h=p-1;h>=0;--h)i.push(a=r.children[h]=new M(l[h],h)),a.parent=r;return(e.parent=new M(null,0)).children=[e],e}function _n(){var n=hn,e=1,r=1,i=null;function a(u){var c=dn(u);if(c.eachAfter(l),c.parent.m=-c.z,c.eachBefore(h),i)u.eachBefore(y);else{var s=u,t=u,o=u;u.eachBefore(function(w){w.x<s.x&&(s=w),w.x>t.x&&(t=w),w.depth>o.depth&&(o=w)});var f=s===t?1:n(s,t)/2,m=f-s.x,d=e/(t.x+f+m),g=r/(o.depth||1);u.eachBefore(function(w){w.x=(w.x+m)*d,w.y=w.depth*g})}return u}function l(u){var c=u.children,s=u.parent.children,t=u.i?s[u.i-1]:null;if(c){fn(u);var o=(c[0].z+c[c.length-1].z)/2;t?(u.z=t.z+n(u._,t._),u.m=u.z-o):u.z=o}else t&&(u.z=t.z+n(u._,t._));u.parent.A=p(u,t,u.parent.A||s[0])}function h(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function p(u,c,s){if(c){for(var t=u,o=u,f=c,m=t.parent.children[0],d=t.m,g=o.m,w=f.m,z=m.m,_;f=b(f),t=N(t),f&&t;)m=N(m),o=b(o),o.a=u,_=f.z+w-t.z-d+n(f._,t._),_>0&&(on(sn(f,u,s),u,_),d+=_,g+=_),w+=f.m,d+=t.m,z+=m.m,g+=o.m;f&&!b(o)&&(o.t=f,o.m+=w-g),t&&!N(m)&&(m.t=t,m.m+=d-z,s=u)}return s}function y(u){u.x*=e,u.y=u.depth*r}return a.separation=function(u){return arguments.length?(n=u,a):n},a.size=function(u){return arguments.length?(i=!1,e=+u[0],r=+u[1],a):i?null:[e,r]},a.nodeSize=function(u){return arguments.length?(i=!0,e=+u[0],r=+u[1],a):i?[e,r]:null},a}function pn(n,e,r,i,a){for(var l=n.children,h,p=-1,y=l.length,u=n.value&&(a-r)/n.value;++p<y;)h=l[p],h.x0=e,h.x1=i,h.y0=r,h.y1=r+=h.value*u}var gn=(1+Math.sqrt(5))/2;function mn(n,e,r,i,a,l){for(var h=[],p=e.children,y,u,c=0,s=0,t=p.length,o,f,m=e.value,d,g,w,z,_,B,x;c<t;){o=a-r,f=l-i;do d=p[s++].value;while(!d&&s<t);for(g=w=d,B=Math.max(f/o,o/f)/(m*n),x=d*d*B,_=Math.max(w/x,x/g);s<t;++s){if(d+=u=p[s].value,u<g&&(g=u),u>w&&(w=u),x=d*d*B,z=Math.max(w/x,x/g),z>_){d-=u;break}_=z}h.push(y={value:d,dice:o<f,children:p.slice(c,s)}),y.dice?rn(y,r,i,a,m?i+=f*d/m:l):pn(y,r,i,m?r+=o*d/m:a,l),m-=d,c=s}return h}const yn=function n(e){function r(i,a,l,h,p){mn(e,i,a,l,h,p)}return r.ratio=function(i){return n((i=+i)>1?i:1)},r}(gn);function zn(){var n=yn,e=!1,r=1,i=1,a=[0],l=k,h=k,p=k,y=k,u=k;function c(t){return t.x0=t.y0=0,t.x1=r,t.y1=i,t.eachBefore(s),a=[0],e&&t.eachBefore(tn),t}function s(t){var o=a[t.depth],f=t.x0+o,m=t.y0+o,d=t.x1-o,g=t.y1-o;d<f&&(f=d=(f+d)/2),g<m&&(m=g=(m+g)/2),t.x0=f,t.y0=m,t.x1=d,t.y1=g,t.children&&(o=a[t.depth+1]=l(t)/2,f+=u(t)-o,m+=h(t)-o,d-=p(t)-o,g-=y(t)-o,d<f&&(f=d=(f+d)/2),g<m&&(m=g=(m+g)/2),n(t,f,m,d,g))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(r=+t[0],i=+t[1],c):[r,i]},c.tile=function(t){return arguments.length?(n=C(t),c):n},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(l=typeof t=="function"?t:I(+t),c):l},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(h=typeof t=="function"?t:I(+t),c):h},c.paddingRight=function(t){return arguments.length?(p=typeof t=="function"?t:I(+t),c):p},c.paddingBottom=function(t){return arguments.length?(y=typeof t=="function"?t:I(+t),c):y},c.paddingLeft=function(t){return arguments.length?(u=typeof t=="function"?t:I(+t),c):u},c}export{zn as a,L as h,wn as s,_n as t};
