import{r as d,j as k}from"./react-BM9L5BSm.js";import{e as Mt,u as $,c as Je,C as Lt}from"./@react-three-DY1ZwaEh.js";import{c as Dt,r as At}from"./graphology-layout-BCx6yjTM.js";import{n as Pt}from"./graphology-layout-noverlap-GOJZRJh7.js";import{f as jt}from"./graphology-layout-forceatlas2-DGj7hbdH.js";import{p as Tt,d as Vt}from"./graphology-metrics-BP1lGx6J.js";import{c as Gt,a as Ft}from"./zustand-ChgGODa3.js";import{j as Bt,h as ue,g as X,k as Ht,Q as et,l as Ut,m as Yt,n as tt,o as Wt,b as Kt,p as Ne,q as Xt,E as nt,r as Oe,D as ne,C as se,S as $t,s as Zt,t as qt,u as Qt,v as Jt,w as en,x as Re,y as tn,z as nn}from"./three-D6Fw_2Dt.js";import{u as on}from"./@use-gesture-DR-9eUnO.js";import"./graphology-shortest-path-DkHpmAp-.js";import{G as rn}from"./graphology-CvMzhiZs.js";import{e as sn}from"./ellipsize-BphF_l5u.js";import{u as J,a as K}from"./@react-spring-BotoEXbK.js";import{C as q}from"./camera-controls-DKxc4fxB.js";import{u as ot}from"./reakeys-BilNghO6.js";import{K as we}from"./hold-event-r4YZTKOh.js";import{S as je,m as ye}from"./three-stdlib-C_TYPwvf.js";import"./classnames-CYM7urtd.js";import{u as de,H as Le,B as rt,T as cn}from"./glodrei-BWF8Sf1f.js";import{f as Se,a as Me,b as st,c as ln,d as it,e as ct,g as an,h as lt,i as un}from"./d3-force-3d-BtlBIo5l.js";import{s as dn,t as fn,h as at,a as pn}from"./d3-hierarchy-C_SYRUw7.js";import{l as gn}from"./d3-scale-BMTWfryO.js";(function(){try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(`._canvas_670zp_1 {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}
._container_155l7_1 {
  transform-origin: bottom right;
  overflow: hidden;
  position: absolute;
  border: solid 1px var(--radial-menu-border);
}

  ._container_155l7_1._disabled_155l7_7 {
    opacity: 0.6;
  }

  ._container_155l7_1._disabled_155l7_7 ._contentContainer_155l7_10 {
      cursor: not-allowed;
    }

  ._container_155l7_1:not(._disabled_155l7_7) ._contentContainer_155l7_10 {
      cursor: pointer;
    }

  ._container_155l7_1:not(._disabled_155l7_7) ._contentContainer_155l7_10:hover {
        color: var(--radial-menu-active-color);
        background: var(--radial-menu-active-background);
      }

  ._container_155l7_1 ._contentContainer_155l7_10 {
    width: 200%;
    height: 200%;
    transform-origin: 50% 50%;
    border-radius: 50%;
    outline: none;
    transition: background 150ms ease-in-out;
    color: var(--radial-menu-color);
  }

  ._container_155l7_1 ._contentContainer_155l7_10 ._contentInner_155l7_35 {
      position: absolute;
      width: 100%;
      text-align: center;
    }

  ._container_155l7_1 ._contentContainer_155l7_10 ._contentInner_155l7_35 ._content_155l7_10 {
        display: inline-block;
      }

  ._container_155l7_1 svg {
    margin: 0 auto;
    fill: var(--radial-menu-active-color);
    height: 25px;
    width: 25px;
    display: block;
  }
._container_x9hyx_1 {
  border-radius: 50%;
  z-index: 9;
  position: relative;
  height: 175px;
  width: 175px;
  border: solid 5px var(--radial-menu-border);
  overflow: hidden;
  background: var(--radial-menu-background);
}

  ._container_x9hyx_1:before {
    content: ' ';
    background: var(--radial-menu-border);
    border-radius: 50%;
    height: 25px;
    width: 25px;
    position: absolute;
    z-index: 9;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }`)),document.head.appendChild(e)}}catch(o){console.error("vite-plugin-css-injected-by-js",o)}})();var Te,Ve;function ut(e,o=[]){const t=o.length;for(const n of e){const r=o.indexOf(n);if(r>-1){const c=[...o.slice(r),n].map(i=>i.data.id);throw new Error(`Invalid Graph: Circular node path detected: ${c.join(" -> ")}.`)}t>n.depth&&(n.depth=t,ut(n.out,[...o,n]))}}function dt(e,o){let t=!1;const n=e.reduce((i,s)=>({...i,[s.id]:{data:s,out:[],depth:-1,ins:[]}}),{});try{for(const i of o){const s=i.source,h=i.target;if(!n.hasOwnProperty(s))throw new Error(`Missing source Node ${s}`);if(!n.hasOwnProperty(h))throw new Error(`Missing target Node ${h}`);const v=n[s],g=n[h];g.ins.push(v),v.out.push(g)}ut(Object.values(n))}catch{t=!0}const r=Object.keys(n).map(i=>n[i].depth),c=Math.max(...r);return{invalid:t,depths:n,maxDepth:c||1}}const Ge=["radialin","radialout"];function vn({nodes:e,edges:o,mode:t="lr",nodeLevelRatio:n=2}){const{depths:r,maxDepth:c,invalid:i}=dt(e,o);if(i)return null;const s=Ge.includes(t)?1:5,h=e.length/c*n*s;if(t){const v=(x,b)=>a=>x?(r[a.id].depth-c/2)*h*(b?-1:1):void 0,g=v(["lr","rl"].includes(t),t==="rl"),E=v(["td","bu"].includes(t),t==="td"),y=v(["zin","zout"].includes(t),t==="zout");e.forEach(x=>{x.fx=g(x),x.fy=E(x),x.fz=y(x)})}return Ge.includes(t)?un(v=>{const g=r[v.id];return(t==="radialin"?c-g.depth:g.depth)*h}).strength(1):null}function mn(e){return new Promise((o,t)=>{let n;function r(){n?o(n):(n=e.step(),r())}r()})}function ge(e){const o=[],t=[];return e.forEachNode((n,r)=>{o.push({...r,id:n,radius:r.size||1})}),e.forEachEdge((n,r)=>{t.push({...r,id:n})}),{nodes:o,edges:t}}function hn(){const e=l=>()=>l;let t=l=>l.index,n=[],r=[],c,i=[100,100],s=e(1),h=e(-1),v=e(100),g=e(.1),E={},y=.1,x=.001,b=[],a=[0,0],u,f=l=>l.cluster,p="treemap",C=!0,D=.1;function w(l){if(!C)return w;p==="force"&&(u.tick(),P());for(let R=0,z=n.length,L,S=l*D;R<z;++R)L=n[R],L.vx+=(E[f(L)].x-L.x)*S,L.vy+=(E[f(L)].y-L.y)*S}function A(){n&&(p==="treemap"?M():V())}w.initialize=function(l){n=l,A()};function G(l){let R=f(l.source),z=f(l.target);return R<=z?R+"~"+z:z+"~"+R}function m(l){let R=new Map,z={};return l.forEach(function(L){R.has(f(L))||R.set(f(L),{count:0,sumforceNodeSize:0})}),l.forEach(function(L){z=R.get(f(L)),z.count=z.count+1,z.sumforceNodeSize=z.sumforceNodeSize+Math.PI*(s(L)*s(L))*1.3,R.set(f(L),z)}),R}function I(l){let R=new Map,z=[];return l.forEach(function(L){let S=G(L),T;R.has(S)?T=R.get(S):T=0,T+=1,R.set(S,T)}),R.forEach(function(L,S){let T,U;T=S.split("~")[0],U=S.split("~")[1],T!==void 0&&U!==void 0&&z.push({source:T,target:U,count:L})}),z}function _(){let l=[],R=[],z=new Map,L,S,T,U,F;U=m(n),F=I(r);for(L of U.keys())T=U.get(L),l.push({id:L,size:T.count,r:Math.sqrt(T.sumforceNodeSize/Math.PI)}),z.set(L,S);return F.forEach(function(W){let te=z.get(W.source),Q=z.get(W.target);te!==void 0&&Q!==void 0&&R.push({source:te,target:Q,count:W.count})}),{nodes:l,links:R}}function O(){let l=[],R,z,L;L=m(w.nodes());for(R of L.keys())z=L.get(R),l.push({id:R,size:z.count});return{id:"clustersTree",children:l}}function P(){return E.none={x:0,y:0},b.forEach(function(l){p==="treemap"?E[l.data.id]={x:l.x0+(l.x1-l.x0)/2-a[0],y:l.y0+(l.y1-l.y0)/2-a[1]}:E[l.id]={x:l.x-a[0],y:l.y-a[1]}}),E}function M(){let l=pn().size(w.size());c=at(O()).sum(R=>R.radius).sort(function(R,z){return z.height-R.height||z.value-R.value}),b=l(c).leaves(),P()}function j(){let l=0;n.length!==0&&r.forEach(function(R){let z,L;if(n){if(z=R.source,L=R.target,typeof R.source!="object"&&(z=n.find(S=>S.id===R.source)),typeof R.target!="object"&&(L=n.find(S=>S.id===R.target)),z===void 0||L===void 0)throw Error("Error setting links, couldnt find nodes for a link (see it on the console)");R.source=z,R.target=L,R.index=l++}})}function V(){let l;!n||!n.length||(j(),l=_(),u=st(l.nodes).force("x",Se(i[0]/2).strength(.1)).force("y",Me(i[1]/2).strength(.1)).force("collide",lt(R=>R.r).iterations(4)).force("charge",ct().strength(h)).force("links",it(l.nodes.length?l.links:[]).distance(v).strength(g)),b=u.nodes(),P())}return w.template=function(l){return arguments.length?(p=l,A(),w):p},w.groupBy=function(l){return arguments.length?typeof l=="string"?(f=function(R){return R[l]},w):(f=l,w):f},w.enableGrouping=function(l){return arguments.length?(C=l,w):C},w.strength=function(l){return arguments.length?(D=l,w):D},w.getLinkStrength=function(l){return C?f(l.source)===f(l.target)?typeof y=="function"?y(l):y:typeof x=="function"?x(l):x:typeof y=="function"?y(l):y},w.id=function(l){return arguments.length?(t=l,w):t},w.size=function(l){return arguments.length?(i=l,w):i},w.linkStrengthInterCluster=function(l){return arguments.length?(x=l,w):x},w.linkStrengthIntraCluster=function(l){return arguments.length?(y=l,w):y},w.nodes=function(l){return arguments.length?(n=l,w):n},w.links=function(l){return arguments.length?(l===null?r=[]:r=l,A(),w):r},w.template=function(l){return arguments.length?(p=l,A(),w):p},w.forceNodeSize=function(l){return arguments.length?(s=typeof l=="function"?l:e(+l),A(),w):s},w.nodeSize=w.forceNodeSize,w.forceCharge=function(l){return arguments.length?(h=typeof l=="function"?l:e(+l),A(),w):h},w.forceLinkDistance=function(l){return arguments.length?(v=typeof l=="function"?l:e(+l),A(),w):v},w.forceLinkStrength=function(l){return arguments.length?(g=typeof l=="function"?l:e(+l),A(),w):g},w.offset=function(l){return arguments.length?(a=typeof l=="function"?l:e(+l),w):a},w.getFocis=P,w}function re({graph:e,nodeLevelRatio:o=2,mode:t=null,dimensions:n=2,nodeStrength:r=-250,linkDistance:c=50,clusterStrength:i=.5,linkStrengthInterCluster:s=.01,linkStrengthIntraCluster:h=.5,forceLinkDistance:v=100,forceLinkStrength:g=.1,clusterType:E="force",forceCharge:y=-700,getNodePosition:x,drags:b,clusterAttribute:a,forceLayout:u}){const{nodes:f,edges:p}=ge(e),D=n===2&&p.length>25?r*2:r;let w,A;u==="forceDirected2d"?(w=Se(),A=Me()):(w=Se(600).strength(.05),A=Me(600).strength(.05));const G=st().force("center",ln(0,0)).force("link",it()).force("charge",ct().strength(D)).force("x",w).force("y",A).force("z",an()).force("collide",lt(O=>O.radius+10)).force("dagRadial",vn({nodes:f,edges:p,mode:t,nodeLevelRatio:o})).stop();let m;if(a){let O=y;if(f!=null&&f.length){const P=Math.ceil(f.length/200);O=y*P}m=hn().strength(i).template(E).groupBy(P=>P.data[a]).links(p).size([100,100]).linkStrengthInterCluster(s).linkStrengthIntraCluster(h).forceLinkDistance(v).forceLinkStrength(g).forceCharge(O).forceNodeSize(P=>P.radius)}let I=G.numDimensions(n).nodes(f);if(m&&(I=I.force("group",m)),c){let O=I.force("link");O&&(O.id(P=>P.id).links(p).distance(c),m&&(O=O.strength((m==null?void 0:m.getLinkStrength)??.1)))}const _=new Map(f.map(O=>[O.id,O]));return{step(){for(;G.alpha()>.01;)G.tick();return!0},getNodePosition(O){var P,M;if(x){const j=x(O,{graph:e,drags:b,nodes:f,edges:p});if(j)return j}return(P=b==null?void 0:b[O])!=null&&P.position?(M=b==null?void 0:b[O])==null?void 0:M.position:_.get(O)}}}function yn({graph:e,radius:o,drags:t,getNodePosition:n}){const r=Dt(e,{scale:o}),{nodes:c,edges:i}=ge(e);return{step(){return!0},getNodePosition(s){var h,v;if(n){const g=n(s,{graph:e,drags:t,nodes:c,edges:i});if(g)return g}return(h=t==null?void 0:t[s])!=null&&h.position?(v=t==null?void 0:t[s])==null?void 0:v.position:r==null?void 0:r[s]}}}const bn={td:{x:"x",y:"y",factor:-1},lr:{x:"y",y:"x",factor:1}};function Fe({graph:e,drags:o,mode:t="td",nodeSeparation:n=1,nodeSize:r=[50,50],getNodePosition:c}){const{nodes:i,edges:s}=ge(e),{depths:h}=dt(i,s),v=Object.keys(h).map(a=>h[a]),g=dn().id(a=>a.data.id).parentId(a=>{var u,f,p;return(p=(f=(u=a.ins)==null?void 0:u[0])==null?void 0:f.data)==null?void 0:p.id})(v),y=fn().separation(()=>n).nodeSize(r)(at(g)).descendants(),x=bn[t],b=new Map(i.map(a=>{const{x:u,y:f}=y.find(p=>p.data.id===a.id);return[a.id,{...a,[x.x]:u*x.factor,[x.y]:f*x.factor,z:0}]}));return{step(){return!0},getNodePosition(a){var u,f;if(c){const p=c(a,{graph:e,drags:o,nodes:i,edges:s});if(p)return p}return(u=o==null?void 0:o[a])!=null&&u.position?(f=o==null?void 0:o[a])==null?void 0:f.position:b.get(a)}}}function xn({graph:e,margin:o,drags:t,getNodePosition:n,ratio:r,gridSize:c,maxIterations:i}){const{nodes:s,edges:h}=ge(e),v=Pt(e,{maxIterations:i,inputReducer:(g,E)=>({...E,x:E.x||0,y:E.y||0}),settings:{ratio:r,margin:o,gridSize:c}});return{step(){return!0},getNodePosition(g){var E,y;if(n){const x=n(g,{graph:e,drags:t,nodes:s,edges:h});if(x)return x}return(E=t==null?void 0:t[g])!=null&&E.position?(y=t==null?void 0:t[g])==null?void 0:y.position:v==null?void 0:v[g]}}}function Cn({graph:e,drags:o,iterations:t,...n}){At.assign(e);const r=jt(e,{iterations:t,settings:n});return{step(){return!0},getNodePosition(c){var i;return((i=o==null?void 0:o[c])==null?void 0:i.position)||(r==null?void 0:r[c])}}}function wn({graph:e,drags:o,getNodePosition:t}){const{nodes:n,edges:r}=ge(e);return{step(){return!0},getNodePosition(c){return t(c,{graph:e,drags:o,nodes:n,edges:r})}}}const En=["forceDirected2d","treeTd2d","treeLr2d","radialOut2d","treeTd3d","treeLr3d","radialOut3d","forceDirected3d"];function _n({type:e,...o}){if(En.includes(e)){const{nodeStrength:t,linkDistance:n,nodeLevelRatio:r}=o;if(e==="forceDirected2d")return re({...o,dimensions:2,nodeLevelRatio:r||2,nodeStrength:t||-250,linkDistance:n,forceLayout:e});if(e==="treeTd2d")return re({...o,mode:"td",dimensions:2,nodeLevelRatio:r||5,nodeStrength:t||-250,linkDistance:n||50,forceLayout:e});if(e==="treeLr2d")return re({...o,mode:"lr",dimensions:2,nodeLevelRatio:r||5,nodeStrength:t||-250,linkDistance:n||50,forceLayout:e});if(e==="radialOut2d")return re({...o,mode:"radialout",dimensions:2,nodeLevelRatio:r||5,nodeStrength:t||-500,linkDistance:n||100,forceLayout:e});if(e==="treeTd3d")return re({...o,mode:"td",dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-500,linkDistance:n||50});if(e==="treeLr3d")return re({...o,mode:"lr",dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-500,linkDistance:n||50,forceLayout:e});if(e==="radialOut3d")return re({...o,mode:"radialout",dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-500,linkDistance:n||100,forceLayout:e});if(e==="forceDirected3d")return re({...o,dimensions:3,nodeLevelRatio:r||2,nodeStrength:t||-250,linkDistance:n,forceLayout:e})}else if(e==="circular2d"){const{radius:t}=o;return yn({...o,radius:t||300})}else{if(e==="hierarchicalTd")return Fe({...o,mode:"td"});if(e==="hierarchicalLr")return Fe({...o,mode:"lr"});if(e==="nooverlap"){const{graph:t,maxIterations:n,ratio:r,margin:c,gridSize:i,...s}=o;return xn({type:"nooverlap",graph:t,margin:c||10,maxIterations:n||50,ratio:r||10,gridSize:i||20,...s})}else if(e==="forceatlas2"){const{graph:t,iterations:n,gravity:r,scalingRatio:c,...i}=o;return Cn({type:"forceatlas2",graph:t,...i,scalingRatio:c||100,gravity:r||10,iterations:n||50})}else if(e==="custom")return wn({type:"custom",...o})}throw new Error(`Layout ${e} not found.`)}function ft({nodeCount:e,nodePosition:o,labelType:t,camera:n}){return(r,c)=>{var i;if(n&&o&&((i=n==null?void 0:n.position)==null?void 0:i.z)/(n==null?void 0:n.zoom)-(o==null?void 0:o.z)>6e3)return!1;if(t==="all")return!0;if(t==="nodes"&&r==="node")return!0;if(t==="edges"&&r==="edge")return!0;if(t==="auto"&&r==="node"){if(c>7)return!0;if(n&&o&&n.position.z/n.zoom-o.z<3e3)return!0}return!1}}function pt(e,o){switch(o){case"above":return e;case"below":return-e;case"inline":case"natural":default:return 0}}function zn({graph:e}){const o=Tt(e);return{ranks:o,getSizeForNode:t=>o[t]*80}}function In({graph:e}){const o=Vt(e);return{ranks:o,getSizeForNode:t=>o[t]*20}}function On({graph:e,attribute:o,defaultSize:t}){const n=new Map;return o?e.forEachNode((r,c)=>{var i;const s=(i=c.data)==null?void 0:i[o];isNaN(s)&&console.warn(`Attribute ${s} is not a number for node ${c.id}`),n.set(r,s||0)}):console.warn("Attribute sizing configured but no attribute provided"),{getSizeForNode:r=>!o||!n?t:n.get(r)}}const Be={pagerank:zn,centrality:In,attribute:On,none:({defaultSize:e})=>({getSizeForNode:o=>e})};function kn({type:e,...o}){var t;const n=(t=Be[e])==null?void 0:t.call(Be,o);if(!n&&e!=="default")throw new Error(`Unknown sizing strategy: ${e}`);const{graph:r,minSize:c,maxSize:i}=o,s=new Map;let h,v;if(r.forEachNode((g,E)=>{let y;e==="default"?y=E.size||o.defaultSize:y=n.getSizeForNode(g),(h===void 0||y<h)&&(h=y),(v===void 0||y>v)&&(v=y),s.set(g,y)}),e!=="none"){const g=gn().domain([h,v]).rangeRound([c,i]);for(const[E,y]of s)s.set(E,g(y))}return s}function Nn(e,o,t){e.clear();for(const n of o)try{e.addNode(n.id,n)}catch({message:r}){console.error(`[Graph] ${r}`)}for(const n of t)try{e.addEdge(n.source,n.target,n)}catch({message:r}){console.error(`[Graph] ${r}`)}return e}function Rn({graph:e,layout:o,sizingType:t,labelType:n,sizingAttribute:r,defaultNodeSize:c,minNodeSize:i,maxNodeSize:s}){const h=[],v=[],g=new Map,E=kn({graph:e,type:t,attribute:r,minSize:i,maxSize:s,defaultSize:c}),y=e.nodes().length,x=ft({nodeCount:y,labelType:n});return e.forEachNode((b,a)=>{const u=o.getNodePosition(b),{data:f,fill:p,icon:C,label:D,size:w,...A}=a,G=E.get(a.id),m=x("node",G),_=(e.inboundNeighbors(a.id)||[]).map(P=>e.getNodeAttributes(P)),O={...a,size:G,labelVisible:m,label:D,icon:C,fill:p,parents:_,data:{...A,...f??{}},position:{...u,x:u.x||0,y:u.y||0,z:u.z||1}};g.set(a.id,O),h.push(O)}),e.forEachEdge((b,a)=>{const u=g.get(a.source),f=g.get(a.target);if(u&&f){const{data:p,id:C,label:D,size:w,...A}=a,G=x("edge",w);v.push({...a,id:C,label:D,labelVisible:G,size:w,data:{...A,id:C,...p||{}}})}}),{nodes:h,edges:v}}const ee={mass:10,tension:1e3,friction:300,precision:.1};function gt(e,o,t){const n=o.getLength(),r=e==="end"?n:n/2,c=e==="end"?t/2:0,i=(r-c)/n,s=o.getPointAt(i),h=o.getTangentAt(i);return[s,h]}function vt(e){return[e+6,2+e/1.5]}const ke=.7;function mt(e,o,t=0){const n=new X(e.x,e.y||0,e.z||0),r=new X(o.x,o.y||0,o.z||0),c=new X().addVectors(n,r).divideScalar(2);return c.setLength(c.length()+t)}function Sn(e,o,t=-1){const n=e.clone(),r=o.clone(),c=new X().subVectors(r,n),i=c.length(),s=c.clone().normalize(),h=new X().subVectors(r,n).divideScalar(2),v=Math.abs(s.x)%1,g=new X(-s.y,s.x-v*s.z,v*s.y).normalize(),E=new X().add(n).add(h).add(g.multiplyScalar(i/4).multiplyScalar(t));return[e,E,o]}function fe(e,o,t,n,r,c){const i=He(e,t,o),s=He(t,e,n);return r?new Zt(...Sn(i,s,c)):new qt(i,s)}function pe(e){return new X(e.position.x,e.position.y,e.position.z||0)}function He(e,o,t){const n=e.distanceTo(o);return e.clone().add(o.clone().sub(e).multiplyScalar(t/n))}function Ue(e,o){return{...e,position:{...e.position,x:e.position.x+o.x,y:e.position.y+o.y,z:e.position.z+o.z}}}function Mn({edge:e,edges:o,curved:t}){let n=t,r;const c=o.filter(i=>i.target===e.target&&i.source===e.source).map(i=>i.id);if(c.length>1){n=!0;const i=c.indexOf(e.id);c.length===2?r=i===0?ke:-ke:r=(i-Math.floor(c.length/2))*ke}return{curved:n,curveOffset:r}}function Ce(e){let o=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(let s of e)o=Math.min(o,s.position.x),t=Math.max(t,s.position.x),n=Math.min(n,s.position.y),r=Math.max(r,s.position.y),c=Math.min(c,s.position.z),i=Math.max(i,s.position.z);return{height:r-n,width:t-o,minX:o,maxX:t,minY:n,maxY:r,minZ:c,maxZ:i,x:(t+o)/2,y:(r+n)/2,z:(i+c)/2}}function Ln(e,o){return o?e.reduce((t,n)=>{const r=n.data[o];return r&&t.set(r,[...t.get(r)||[],n]),t},new Map):new Map}function Dn({nodes:e,clusterAttribute:o}){const t=new Map;if(o){const n=Ln(e,o);for(const[r,c]of n){const i=Ce(c);t.set(r,{label:r,nodes:c,position:i})}}return t}const De=({sensitivity:e=7,interval:o=50,timeout:t=0,disabled:n,onPointerOver:r,onPointerOut:c})=>{const i=d.useRef(!1),s=d.useRef(null),h=d.useRef(0),v=d.useRef({x:null,y:null,px:null,py:null}),g=d.useCallback(u=>{v.current.x=u.clientX,v.current.y=u.clientY},[]),E=d.useCallback(u=>{s.current=clearTimeout(s.current);const{px:f,x:p,py:C,y:D}=v.current;Math.abs(f-p)+Math.abs(C-D)<e?(h.current=1,r(u)):(v.current.px=p,v.current.py=D,s.current=setTimeout(()=>E(u),o))},[o,r,e]),y=d.useCallback(()=>{clearTimeout(s.current),typeof window<"u"&&document.removeEventListener("mousemove",g,!1)},[g]),x=d.useCallback(u=>{n||(i.current=!0,y(),h.current!==1&&(v.current.px=u.pointer.x,v.current.py=u.pointer.y,typeof window<"u"&&document.addEventListener("mousemove",g,!1),s.current=setTimeout(()=>E(u),t)))},[y,E,n,g,t]),b=d.useCallback(u=>{s.current=clearTimeout(s.current),h.current=0,c(u)},[c]),a=d.useCallback(u=>{i.current=!1,y(),h.current===1&&(s.current=setTimeout(()=>b(u),t))},[y,b,t]);return{pointerOver:x,pointerOut:a}},An=({draggable:e,set:o,position:t,onDragStart:n,onDragEnd:r})=>{const c=$(a=>a.camera),i=$(a=>a.raycaster),s=$(a=>a.size),h=$(a=>a.gl),{mouse2D:v,mouse3D:g,offset:E,normal:y,plane:x}=d.useMemo(()=>({mouse2D:new ue,mouse3D:new X,offset:new X,normal:new X,plane:new Qt}),[]),b=d.useMemo(()=>h.domElement.getBoundingClientRect(),[h.domElement]);return on({onDragStart:({event:a})=>{const{eventObject:u,point:f}=a;u.getWorldPosition(E).sub(f),g.copy(f),n()},onDrag:({xy:a})=>{const u=(a[0]-((b==null?void 0:b.left)??0))/s.width*2-1,f=-((a[1]-((b==null?void 0:b.top)??0))/s.height)*2+1;v.set(u,f),i.setFromCamera(v,c),c.getWorldDirection(y).negate(),x.setFromNormalAndCoplanarPoint(y,g),i.ray.intersectPlane(x,g);const p=new X(t.x,t.y,t.z).copy(g).add(E);return o(p)},onDragEnd:r},{drag:{enabled:e,threshold:10}})},{Provider:Pn,useStore:N}=Gt(),jn=({actives:e=[],selections:o=[],collapsedNodeIds:t=[],theme:n})=>Ft(r=>({theme:{...n,edge:{...n.edge,label:{...n.edge.label,fontSize:n.edge.label.fontSize??6}}},edges:[],nodes:[],collapsedNodeIds:t,clusters:new Map,panning:!1,draggingId:null,actives:e,edgeContextMenus:new Set,edgeMeshes:[],selections:o,drags:{},graph:new rn({multi:!0}),setTheme:c=>r(i=>({...i,theme:c})),setClusters:c=>r(i=>({...i,clusters:c})),setEdgeContextMenus:c=>r(i=>({...i,edgeContextMenus:c})),setEdgeMeshes:c=>r(i=>({...i,edgeMeshes:c})),setPanning:c=>r(i=>({...i,panning:c})),setDrags:c=>r(i=>({...i,drags:c})),setDraggingId:c=>r(i=>({...i,draggingId:c})),setActives:c=>r(i=>({...i,actives:c})),setSelections:c=>r(i=>({...i,selections:c})),setNodes:c=>r(i=>({...i,nodes:c,centerPosition:Ce(c)})),setEdges:c=>r(i=>({...i,edges:c})),setNodePosition:(c,i)=>r(s=>{var h,v;const g=s.nodes.find(a=>a.id===c),E=pe(g),x=new X(i.x,i.y,i.z).sub(E),b=[...s.nodes];if((h=s.selections)!=null&&h.includes(c))(v=s.selections)==null||v.forEach(a=>{const u=s.nodes.find(f=>f.id===a);if(u){const f=s.nodes.indexOf(u);b[f]=Ue(u,x)}});else{const a=s.nodes.indexOf(g);b[a]=Ue(g,x)}return{...s,drags:{...s.drags,[c]:g},nodes:b}}),setCollapsedNodeIds:(c=[])=>r(i=>({...i,collapsedNodeIds:c}))}));function ht({nodeId:e,nodes:o,edges:t,currentHiddenNodes:n,currentHiddenEdges:r}){const c=[],i=[],s=n.map(x=>x.id),h=r.map(x=>x.id),v=t.filter(x=>x.source===e),g=v.map(x=>x.target);i.push(...v);for(const x of g){const b=t.filter(u=>u.target===x&&u.source!==e);let a=!1;if((b.length===0||b.length>0&&!s.includes(x)&&b.map(f=>f.id).every(f=>h.includes(f)))&&(a=!0),a){const u=o.find(p=>p.id===x);u&&c.push(u);const f=ht({nodeId:x,nodes:o,edges:t,currentHiddenEdges:i,currentHiddenNodes:c});i.push(...f.hiddenEdges),c.push(...f.hiddenNodes)}}const E=Object.values(i.reduce((x,b)=>({...x,[b.id]:b}),{})),y=Object.values(c.reduce((x,b)=>({...x,[b.id]:b}),{}));return{hiddenEdges:E,hiddenNodes:y}}const Tn=({collapsedIds:e,nodes:o,edges:t})=>{const n=[],r=[];for(const v of e){const{hiddenEdges:g,hiddenNodes:E}=ht({nodeId:v,nodes:o,edges:t,currentHiddenEdges:r,currentHiddenNodes:n});n.push(...E),r.push(...g)}const c=n.map(v=>v.id),i=r.map(v=>v.id),s=o.filter(v=>!c.includes(v.id)),h=t.filter(v=>!i.includes(v.id));return{visibleNodes:s,visibleEdges:h}},Vn=({layoutType:e,sizingType:o,labelType:t,sizingAttribute:n,clusterAttribute:r,selections:c,nodes:i,edges:s,actives:h,collapsedNodeIds:v,defaultNodeSize:g,maxNodeSize:E,minNodeSize:y,layoutOverrides:x})=>{const b=N(l=>l.graph),a=N(l=>l.setClusters),u=N(l=>l.collapsedNodeIds),f=N(l=>l.setEdges),p=N(l=>l.nodes),C=N(l=>l.setNodes),D=N(l=>l.setSelections),w=N(l=>l.setActives),A=N(l=>l.drags),G=N(l=>l.setDrags),m=N(l=>l.setCollapsedNodeIds),I=d.useRef(!1),_=d.useRef(null),O=$(l=>l.camera),{visibleEdges:P,visibleNodes:M}=d.useMemo(()=>Tn({collapsedIds:u,nodes:i,edges:s}),[u,i,s]),j=d.useRef(A);d.useEffect(()=>{j.current=A},[A]);const V=d.useCallback(async l=>{_.current=l||_n({...x,type:e,graph:b,drags:j.current,clusterAttribute:r}),await mn(_.current);const R=Rn({graph:b,layout:_.current,sizingType:o,labelType:t,sizingAttribute:n,maxNodeSize:E,minNodeSize:y,defaultNodeSize:g}),z=Dn({nodes:R.nodes,clusterAttribute:r});f(R.edges),C(R.nodes),a(z)},[x,e,r,o,t,n,E,y,g,f,C,a]);d.useEffect(()=>{const l=p.map(z=>({...z,labelVisible:ft({nodeCount:p==null?void 0:p.length,labelType:t,camera:O,nodePosition:z==null?void 0:z.position})("node",z==null?void 0:z.size)}));l.some((z,L)=>z.labelVisible!==p[L].labelVisible)&&C(l)},[O,O.zoom,O.position.z,C,p,t]),d.useEffect(()=>{I.current&&D(c)},[c,D]),d.useEffect(()=>{I.current&&w(h)},[h,w]),d.useEffect(()=>{async function l(){I.current=!1,Nn(b,M,P),await V(),I.current=!0}l()},[M,P]),d.useEffect(()=>{I.current&&m(v)},[v,m]),d.useEffect(()=>{I.current&&(j.current={},G({}),V())},[e,V,G]),d.useEffect(()=>{I.current&&V(_.current)},[o,n,t,V])},ce=({text:e,fontSize:o,fontUrl:t,color:n,opacity:r,stroke:c,active:i,ellipsis:s,rotation:h})=>{const v=s&&!i?sn(e,s):e,g=d.useMemo(()=>new se(n),[n]),E=d.useMemo(()=>c?new se(c):void 0,[c]);return k.jsx(rt,{position:[0,0,1],children:k.jsx(cn,{font:t,fontSize:o,color:g,fillOpacity:r,textAlign:"center",outlineWidth:c?1:0,outlineColor:E,depthOffset:0,maxWidth:100,overflowWrap:"break-word",rotation:h,children:v})})};ce.defaultProps={opacity:1,fontSize:7,color:"#2A6475",ellipsis:75};const yt=({color:e,size:o,opacity:t,animated:n,strokeWidth:r,innerRadius:c=4,segments:i=25})=>{const s=d.useMemo(()=>new se(e),[e]),{ringSize:h,ringOpacity:v}=J({from:{ringOpacity:0,ringSize:[1e-5,1e-5,1e-5]},to:{ringOpacity:t,ringSize:[o/2,o/2,1]},config:{...ee,duration:n?void 0:0}}),g=r/10,E=c+g;return k.jsx(rt,{position:[0,0,1],children:k.jsxs(K.mesh,{scale:h,children:[k.jsx("ringGeometry",{attach:"geometry",args:[c,E,i]}),k.jsx(K.meshBasicMaterial,{attach:"material",color:s,transparent:!0,depthTest:!1,opacity:v,side:ne,fog:!0})]})})};yt.defaultProps={color:"#D8E6EA",size:1,opacity:.5,strokeWidth:5};const bt=({color:e,id:o,size:t,active:n,selected:r,opacity:c,animated:i})=>{const{scale:s,nodeOpacity:h}=J({from:{scale:[1e-5,1e-5,1e-5],nodeOpacity:0},to:{scale:[t,t,t],nodeOpacity:c},config:{...ee,duration:i?void 0:0}}),v=d.useMemo(()=>new se(e),[e]),g=N(E=>E.theme);return k.jsxs(k.Fragment,{children:[k.jsxs(K.mesh,{userData:{id:o,type:"node"},scale:s,children:[k.jsx("sphereGeometry",{attach:"geometry",args:[1,25,25]}),k.jsx(K.meshPhongMaterial,{attach:"material",side:ne,transparent:!0,fog:!0,opacity:h,color:v})]}),k.jsx(yt,{opacity:r?.5:0,size:t,animated:i,color:r?g.ring.activeFill:g.ring.fill})]})};bt.defaultProps={opacity:1,active:!1};const xt=d.createContext({controls:null,resetControls:()=>{},zoomIn:()=>{},zoomOut:()=>{},dollyIn:()=>{},dollyOut:()=>{},panLeft:()=>{},panRight:()=>{},panUp:()=>{},panDown:()=>{}}),Ae=()=>{const e=d.useContext(xt);if(e===void 0)throw new Error("`useCameraControls` hook must be used within a `ControlsProvider` component");return e};q.install({THREE:{MOUSE:Bt,Vector2:ue,Vector3:X,Vector4:Ht,Quaternion:et,Matrix4:Ut,Spherical:Yt,Box3:tt,Sphere:Wt,Raycaster:Kt,MathUtils:{DEG2RAD:(Te=Ne)==null?void 0:Te.DEG2RAD,clamp:(Ve=Ne)==null?void 0:Ve.clamp}}});Mt({ThreeCameraControls:q});const Ee={ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40},Ye=new we(Ee.ARROW_LEFT,100),We=new we(Ee.ARROW_RIGHT,100),Ke=new we(Ee.ARROW_UP,100),Xe=new we(Ee.ARROW_DOWN,100),Ct=d.forwardRef(({mode:e,children:o,animated:t,disabled:n,minDistance:r,maxDistance:c},i)=>{const s=d.useRef(null),h=$(m=>m.camera),v=$(m=>m.gl),g=e==="orbit",E=N(m=>m.setPanning),y=N(m=>m.draggingId);Je((m,I)=>{var _,O;(_=s.current)!=null&&_.enabled&&((O=s.current)==null||O.update(I)),g&&(s.current.azimuthAngle+=20*I*Ne.DEG2RAD)},-1),d.useEffect(()=>()=>{var m;return(m=s.current)==null?void 0:m.dispose()},[]);const x=d.useCallback(()=>{var m;(m=s.current)==null||m.zoom(h.zoom/2,t)},[t,h.zoom]),b=d.useCallback(()=>{var m;(m=s.current)==null||m.zoom(-h.zoom/2,t)},[t,h.zoom]),a=d.useCallback(m=>{var I;(I=s.current)==null||I.dolly(m,t)},[t]),u=d.useCallback(m=>{var I;(I=s.current)==null||I.dolly(m,t)},[t]),f=d.useCallback(m=>{var I;g||(I=s.current)==null||I.truck(-.03*m.deltaTime,0,t)},[t,g]),p=d.useCallback(m=>{var I;g||(I=s.current)==null||I.truck(.03*m.deltaTime,0,t)},[t,g]),C=d.useCallback(m=>{var I;g||(I=s.current)==null||I.truck(0,.03*m.deltaTime,t)},[t,g]),D=d.useCallback(m=>{var I;g||(I=s.current)==null||I.truck(0,-.03*m.deltaTime,t)},[t,g]),w=d.useCallback(m=>{m.code==="Space"&&(e==="rotate"?s.current.mouseButtons.left=q.ACTION.TRUCK:s.current.mouseButtons.left=q.ACTION.ROTATE)},[e]),A=d.useCallback(m=>{m.code==="Space"&&(e==="rotate"?s.current.mouseButtons.left=q.ACTION.ROTATE:s.current.mouseButtons.left=q.ACTION.TRUCK)},[e]);d.useEffect(()=>(n||(Ye.addEventListener("holding",p),We.addEventListener("holding",f),Ke.addEventListener("holding",C),Xe.addEventListener("holding",D),typeof window<"u"&&(window.addEventListener("keydown",w),window.addEventListener("keyup",A))),()=>{Ye.removeEventListener("holding",p),We.removeEventListener("holding",f),Ke.removeEventListener("holding",C),Xe.removeEventListener("holding",D),typeof window<"u"&&(window.removeEventListener("keydown",w),window.removeEventListener("keyup",A))}),[n,w,A,D,p,f,C]),d.useEffect(()=>{n?(s.current.mouseButtons.left=q.ACTION.NONE,s.current.mouseButtons.middle=q.ACTION.NONE,s.current.mouseButtons.wheel=q.ACTION.NONE):(s.current.mouseButtons.left=q.ACTION.TRUCK,s.current.mouseButtons.middle=q.ACTION.TRUCK,s.current.mouseButtons.wheel=q.ACTION.DOLLY)},[n]),d.useEffect(()=>{const m=()=>E(!0),I=()=>E(!1),_=s.current;return _&&(_.addEventListener("control",m),_.addEventListener("controlend",I)),()=>{_&&(_.removeEventListener("control",m),_.removeEventListener("controlend",I))}},[s,E]),d.useEffect(()=>{y?s.current.mouseButtons.left=q.ACTION.NONE:e==="rotate"?s.current.mouseButtons.left=q.ACTION.ROTATE:s.current.mouseButtons.left=q.ACTION.TRUCK},[y,e]),ot([{name:"Zoom In",disabled:n,category:"Graph",keys:"command+shift+i",callback:m=>{m.preventDefault(),x()}},{name:"Zoom Out",category:"Graph",disabled:n,keys:"command+shift+o",callback:m=>{m.preventDefault(),b()}}]);const G=d.useMemo(()=>({controls:s.current,zoomIn:()=>x(),zoomOut:()=>b(),dollyIn:(m=1e3)=>a(m),dollyOut:(m=-1e3)=>u(m),panLeft:(m=100)=>p({deltaTime:m}),panRight:(m=100)=>f({deltaTime:m}),panDown:(m=100)=>D({deltaTime:m}),panUp:(m=100)=>C({deltaTime:m}),resetControls:m=>{var I;return(I=s.current)==null?void 0:I.reset(m)}}),[x,b,p,f,D,C,s.current]);return d.useImperativeHandle(i,()=>G),k.jsxs(xt.Provider,{value:G,children:[k.jsx("threeCameraControls",{ref:s,args:[h,v.domElement],smoothTime:.1,minDistance:r,dollyToCursor:!0,maxDistance:c}),o]})});Ct.defaultProps={mode:"rotate",minDistance:1e3,maxDistance:5e4};function wt(e,o){const t=o.position.z;e<t?e-=t:e+=t;const n=o.fov/o.zoom*Math.PI/180;return 2*Math.tan(n/2)*Math.abs(e)}function Gn(e,o){return wt(e,o)*o.aspect}function $e(e,o){var t,n,r,c;const i=Gn(1,e),s=wt(1,e),h={x0:((t=e==null?void 0:e.position)==null?void 0:t.x)-i/2,x1:((n=e==null?void 0:e.position)==null?void 0:n.x)+i/2,y0:((r=e==null?void 0:e.position)==null?void 0:r.y)-s/2,y1:((c=e==null?void 0:e.position)==null?void 0:c.y)+s/2};return(o==null?void 0:o.x)>h.x0&&(o==null?void 0:o.x)<h.x1&&(o==null?void 0:o.y)>h.y0&&(o==null?void 0:o.y)<h.y1}function Ze(e,o){return o.reduce((t,n)=>Math.abs(n-e%Math.PI)<Math.abs(t-e%Math.PI)?n:t)}function Fn(e,o){const t=Ze(e,[0,Math.PI]),n=Ze(o,[Math.PI/2,3*Math.PI/2]);return{horizontalRotation:t-e%Math.PI,verticalRotation:n-o%Math.PI}}const be=50,Bn=({animated:e,disabled:o,layoutType:t})=>{const n=N(a=>a.nodes),[r,c]=d.useState(!1),i=$(a=>a.invalidate),{controls:s}=Ae(),h=$(a=>a.camera),v=d.useRef(!1),g=d.useCallback(async(a,u)=>{const f=(u==null?void 0:u.animated)!==void 0?u==null?void 0:u.animated:!0,p=(u==null?void 0:u.centerOnlyIfNodesNotInView)!==void 0?u==null?void 0:u.centerOnlyIfNodesNotInView:!1;if(!v.current||!p||p&&(a!=null&&a.some(C=>!$e(h,C.position)))){const{x:C,y:D,z:w}=Ce(a);await s.setTarget(C,D,w,f),r||c(!0),i()}},[i,s,n]),E=d.useCallback(async(a,u={animated:!0,fitOnlyIfNodesNotInView:!1})=>{const{fitOnlyIfNodesNotInView:f}=u;if(!f||f&&(a!=null&&a.some(p=>!$e(h,p.position)))){const{minX:p,maxX:C,minY:D,maxY:w,minZ:A,maxZ:G}=Ce(a);if(!t.includes("3d")){const{horizontalRotation:m,verticalRotation:I}=Fn(s==null?void 0:s.azimuthAngle,s==null?void 0:s.polarAngle);s==null||s.rotate(m,I,!0)}await(s==null?void 0:s.zoomTo(1,u==null?void 0:u.animated)),await(s==null?void 0:s.fitToBox(new tt(new X(p,D,A),new X(C,w,G)),u==null?void 0:u.animated,{cover:!1,paddingLeft:be,paddingRight:be,paddingBottom:be,paddingTop:be}))}},[h,s,t]),y=d.useCallback(a=>{let u=null;return a!=null&&a.length&&(u=a.reduce((f,p)=>{const C=n.find(D=>D.id===p);if(C)f.push(C);else throw new Error(`Attempted to center ${p} but it was not found in the nodes`);return f},[])),u},[n]),x=d.useCallback((a,u)=>{const f=y(a);g(f||n,{animated:e,centerOnlyIfNodesNotInView:u==null?void 0:u.centerOnlyIfNodesNotInView})},[e,g,y,n]),b=d.useCallback(async(a,u)=>{const f=y(a);await E(f||n,{animated:e,...u})},[e,E,y,n]);return d.useLayoutEffect(()=>{async function a(){s&&(n!=null&&n.length)&&(v.current||(await g(n,{animated:!1}),await E(n,{animated:!1}),v.current=!0))}a()},[s,g,n,e,h,E]),ot([{name:"Center",disabled:o,category:"Graph",keys:["command+shift+c"],callback:()=>g(n)}]),{centerNodes:g,centerNodesById:x,fitNodesInViewById:b,isCentered:r}},Et=({image:e,id:o,size:t,opacity:n,animated:r})=>{const c=d.useMemo(()=>new Jt().load(e),[e]),{scale:i,spriteOpacity:s}=J({from:{scale:[1e-5,1e-5,1e-5],spriteOpacity:0},to:{scale:[t,t,t],spriteOpacity:n},config:{...ee,duration:r?void 0:0}});return k.jsx(K.sprite,{userData:{id:o,type:"node"},scale:i,children:k.jsx(K.spriteMaterial,{attach:"material",opacity:s,fog:!0,depthTest:!1,transparent:!0,side:ne,children:k.jsx("primitive",{attach:"map",object:c,minFilter:en})})})};Et.defaultProps={opacity:1};const _t=({animated:e,disabled:o,id:t,draggable:n,labelFontUrl:r,contextMenu:c,onClick:i,onDoubleClick:s,onPointerOver:h,onDragged:v,onPointerOut:g,onContextMenu:E,renderNode:y})=>{var x,b,a;const u=Ae(),f=N(B=>B.theme),p=N(B=>B.nodes.find(Z=>Z.id===t)),C=N(B=>B.edges),D=N(B=>B.draggingId),w=N(B=>B.collapsedNodeIds),A=N(B=>B.setDraggingId),G=N(B=>B.setNodePosition),m=N(B=>B.setCollapsedNodeIds),I=N(B=>B.collapsedNodeIds.includes(t)),_=N(B=>{var Z;return(Z=B.actives)==null?void 0:Z.includes(t)}),O=N(B=>{var Z;return(Z=B.selections)==null?void 0:Z.includes(t)}),P=N(B=>{var Z;return((Z=B.selections)==null?void 0:Z.length)>0}),M=N(B=>B.centerPosition),j=D===t,{position:V,label:l,subLabel:R,size:z=7,labelVisible:L=!0}=p,S=d.useRef(null),[T,U]=d.useState(!1),[F,W]=d.useState(!1),te=T||O||_,Q=P?te?f.node.selectedOpacity:f.node.inactiveOpacity:f.node.opacity,oe=d.useMemo(()=>C.filter(Z=>Z.source===t).length>0||I,[C,t,I]),le=d.useCallback(()=>{oe&&m(I?w.filter(B=>B!==t):[...w,t])},[oe,w,t,I,m]),[{nodePosition:_e,labelPosition:ve,subLabelPosition:me}]=J(()=>({from:{nodePosition:M?[M.x,M.y,0]:[0,0,0],labelPosition:[0,-(z+7),2],subLabelPosition:[0,-(z+14),2]},to:{nodePosition:V?[V.x,V.y,te?V.z+1:V.z]:[0,0,0],labelPosition:[0,-(z+7),2],subLabelPosition:[0,-(z+14),2]},config:{...ee,duration:e&&!D?void 0:0}}),[j,V,e,z,te]),H=An({draggable:n,position:V,set:B=>G(t,B),onDragStart:()=>{A(t),U(!0)},onDragEnd:()=>{A(null),U(!1),v==null||v(p)}});de(T&&!D&&i!==void 0,"pointer"),de(T&&n&&!j&&i===void 0,"grab"),de(j,"grabbing");const Y=te||j,ie=Y?f.node.activeFill:p.fill||f.node.fill,{pointerOver:ze,pointerOut:ae}=De({disabled:o||j,onPointerOver:B=>{u.controls.truckSpeed=0,U(!0),h==null||h(p,B)},onPointerOut:B=>{u.controls.truckSpeed=2,U(!1),g==null||g(p,B)}}),he=d.useMemo(()=>y?y({id:t,color:ie,size:z,active:Y,opacity:Q,animated:e,selected:O,node:p}):k.jsx(k.Fragment,{children:p.icon?k.jsx(Et,{id:t,image:p.icon||"",size:z+8,opacity:Q,animated:e,color:ie,node:p,active:Y,selected:O}):k.jsx(bt,{id:t,size:z,opacity:Q,animated:e,color:ie,node:p,active:Y,selected:O})}),[y,t,ie,z,Y,Q,e,O,p]),Ie=d.useMemo(()=>{var B,Z,Pe;return L&&(L||O||T)&&l&&k.jsxs(k.Fragment,{children:[k.jsx(K.group,{position:ve,children:k.jsx(ce,{text:l,fontUrl:r,opacity:Q,stroke:f.node.label.stroke,active:O||T||j||_,color:O||T||j||_?f.node.label.activeColor:f.node.label.color})}),R&&k.jsx(K.group,{position:me,children:k.jsx(ce,{text:R,fontUrl:r,fontSize:5,opacity:Q,stroke:(B=f.node.subLabel)==null?void 0:B.stroke,active:O||T||j||_,color:O||T||j||_?(Z=f.node.subLabel)==null?void 0:Z.activeColor:(Pe=f.node.subLabel)==null?void 0:Pe.color})})]})},[T,_,j,O,l,r,ve,L,Q,R,me,f.node.label.activeColor,f.node.label.color,f.node.label.stroke,(x=f.node.subLabel)==null?void 0:x.activeColor,(b=f.node.subLabel)==null?void 0:b.color,(a=f.node.subLabel)==null?void 0:a.stroke]),St=d.useMemo(()=>F&&c&&k.jsx(Le,{prepend:!0,center:!0,children:c({data:p,canCollapse:oe,isCollapsed:I,onCollapse:le,onClose:()=>W(!1)})}),[F,c,p,oe,I,le]);return k.jsxs(K.group,{renderOrder:1,userData:{id:t,type:"node"},ref:S,position:_e,onPointerOver:ze,onPointerOut:ae,onClick:B=>{!o&&!j&&(i==null||i(p,{canCollapse:oe,isCollapsed:I},B))},onDoubleClick:B=>{!o&&!j&&(s==null||s(p,B))},onContextMenu:()=>{o||(W(!0),E==null||E(p,{canCollapse:oe,isCollapsed:I,onCollapse:le}))},...H(),children:[he,St,Ie]})};_t.defaultProps={draggable:!1};const zt=({animated:e,color:o,length:t,opacity:n,position:r,rotation:c,size:i,onActive:s,onContextMenu:h})=>{const v=d.useMemo(()=>new se(o),[o]),g=d.useRef(null),E=N(u=>u.draggingId),y=N(u=>u.centerPosition),[{pos:x,arrowOpacity:b}]=J(()=>({from:{pos:y?[y.x,y.y,y.z]:[0,0,0],arrowOpacity:0},to:{pos:[r.x,r.y,r.z],arrowOpacity:n},config:{...ee,duration:e&&!E?void 0:0}}),[e,E,n,r]),a=d.useCallback(()=>{var u;const f=new X(0,1,0);(u=g.current)==null||u.quaternion.setFromUnitVectors(f,c)},[c,g]);return d.useEffect(()=>a(),[a]),k.jsxs(K.mesh,{position:x,ref:g,scale:[1,1,1],onPointerOver:()=>s(!0),onPointerOut:()=>s(!1),onPointerDown:u=>{u.nativeEvent.buttons===2&&(u.stopPropagation(),h())},children:[k.jsx("cylinderGeometry",{args:[0,i,t,20,1,!0],attach:"geometry"}),k.jsx(K.meshBasicMaterial,{attach:"material",color:v,depthTest:!1,opacity:b,transparent:!0,side:ne,fog:!0})]})};zt.defaultProps={size:1,opacity:.5,color:"#D8E6EA"};const It=({curveOffset:e,animated:o,color:t,curve:n,curved:r=!1,id:c,opacity:i,size:s,onContextMenu:h,onClick:v,onPointerOver:g,onPointerOut:E})=>{const y=d.useRef(null),x=N(p=>p.draggingId),b=d.useMemo(()=>new se(t),[t]),a=N(p=>p.centerPosition),u=d.useRef(!1),{lineOpacity:f}=J({from:{lineOpacity:0},to:{lineOpacity:i},config:{...ee,duration:o?void 0:0}});return J(()=>{const p=n.getPoint(0),C=n.getPoint(1);return{from:{fromVertices:u.current?[C==null?void 0:C.x,C==null?void 0:C.y,(C==null?void 0:C.z)||0]:[a==null?void 0:a.x,a==null?void 0:a.y,(a==null?void 0:a.z)||0],toVertices:[p==null?void 0:p.x,p==null?void 0:p.y,(p==null?void 0:p.z)||0]},to:{fromVertices:[p==null?void 0:p.x,p==null?void 0:p.y,(p==null?void 0:p.z)||0],toVertices:[C==null?void 0:C.x,C==null?void 0:C.y,(C==null?void 0:C.z)||0]},onChange:D=>{const{fromVertices:w,toVertices:A}=D.value,G=new X(...w),m=new X(...A),I=fe(G,0,m,0,r,e);y.current.copy(new Re(I,20,s/2,5,!1))},config:{...ee,duration:o&&!x?void 0:0}}},[o,x,n,s]),d.useEffect(()=>{u.current=!0},[]),k.jsxs("mesh",{userData:{id:c,type:"edge"},onPointerOver:g,onPointerOut:E,onClick:v,onPointerDown:p=>{p.nativeEvent.buttons===2&&(p.stopPropagation(),h())},children:[k.jsx("tubeGeometry",{attach:"geometry",ref:y}),k.jsx(K.meshBasicMaterial,{attach:"material",opacity:f,fog:!0,transparent:!0,depthTest:!1,color:b})]})};It.defaultProps={color:"#000",size:1,opacity:1};const qe=3,Ot=({animated:e,arrowPlacement:o,contextMenu:t,disabled:n,labelPlacement:r,id:c,interpolation:i,labelFontUrl:s,onContextMenu:h,onClick:v,onPointerOver:g,onPointerOut:E})=>{const y=N(H=>H.theme),x=N(H=>H.draggingId),[b,a]=d.useState(!1),[u,f]=d.useState(!1),p=N(H=>H.edges),C=p.find(H=>H.id===c),{target:D,source:w,label:A,labelVisible:G=!1,size:m=1}=C,I=N(H=>H.nodes.find(Y=>Y.id===w)),_=N(H=>H.nodes.find(Y=>Y.id===D)),O=(m+y.edge.label.fontSize)/2,[P,M]=d.useMemo(()=>vt(m),[m]),{curveOffset:j,curved:V}=d.useMemo(()=>Mn({edge:C,edges:p,curved:i==="curved"}),[C,p,i]),[l,R,z]=d.useMemo(()=>{const H=pe(I),Y=I.size,ie=pe(_),ze=_.size;let ae=fe(H,Y,ie,ze,V,j);const[he,Ie]=gt(o,ae,P);return o==="end"&&(ae=fe(H,Y,he,0,V,j)),[ae,he,Ie]},[I,_,V,j,o,P]),L=d.useMemo(()=>{let H=mt(I.position,_.position,pt(O,r));if(V){const Y=new X().subVectors(H,l.getPoint(.5));switch(r){case"above":Y.y=Y.y-qe;break;case"below":Y.y=Y.y+qe;break}H=H.sub(Y)}return H},[I.position,_.position,O,r,V,l]),S=N(H=>{var Y;return(Y=H.selections)==null?void 0:Y.includes(c)}),T=N(H=>{var Y;return(Y=H.selections)==null?void 0:Y.length}),U=N(H=>{var Y;return(Y=H.actives)==null?void 0:Y.includes(c)}),F=N(H=>H.centerPosition),W=T?S||U?y.edge.selectedOpacity:y.edge.inactiveOpacity:y.edge.opacity,[{labelPosition:te}]=J(()=>({from:{labelPosition:F?[F.x,F.y,F.z]:[0,0,0]},to:{labelPosition:[L.x,L.y,L.z]},config:{...ee,duration:e&&!x?void 0:0}}),[L,e,x]),Q=d.useMemo(()=>new nt(0,0,r==="natural"?0:Math.atan((_.position.y-I.position.y)/(_.position.x-I.position.x))),[_.position.x,_.position.y,I.position.x,I.position.y,r]);de(b&&!x&&v!==void 0,"pointer");const{pointerOver:oe,pointerOut:le}=De({disabled:n,onPointerOver:H=>{a(!0),g==null||g(C,H)},onPointerOut:H=>{a(!1),E==null||E(C,H)}}),_e=d.useMemo(()=>o!=="none"&&k.jsx(zt,{animated:e,color:S||b||U?y.arrow.activeFill:y.arrow.fill,length:P,opacity:W,position:R,rotation:z,size:M,onActive:a,onContextMenu:()=>{n||(f(!0),h==null||h(C))}}),[b,e,P,o,R,z,M,n,C,U,S,h,W,y.arrow.activeFill,y.arrow.fill]),ve=d.useMemo(()=>G&&A&&k.jsx(K.group,{position:te,children:k.jsx(ce,{text:A,ellipsis:15,fontUrl:s,stroke:y.edge.label.stroke,color:S||b||U?y.edge.label.activeColor:y.edge.label.color,opacity:W,fontSize:y.edge.label.fontSize,rotation:Q})}),[b,U,S,A,s,te,Q,G,W,y.edge.label.activeColor,y.edge.label.color,y.edge.label.fontSize,y.edge.label.stroke]),me=d.useMemo(()=>u&&t&&k.jsx(Le,{prepend:!0,center:!0,position:L,children:t({data:C,onClose:()=>f(!1)})}),[u,t,L,C]);return k.jsxs("group",{children:[k.jsx(It,{curveOffset:j,animated:e,color:S||b||U?y.edge.activeFill:y.edge.fill,curve:l,curved:V,id:c,opacity:W,size:m,onClick:H=>{n||v==null||v(C,H)},onPointerOver:oe,onPointerOut:le,onContextMenu:()=>{n||(f(!0),h==null||h(C))}}),_e,ve,me]})};Ot.defaultProps={labelPlacement:"inline",arrowPlacement:"end"};const Qe=new Xt(0,0,0);function Hn(e,o){const t=d.useRef(),n=N(h=>h.theme);N(h=>{t.current=h});const r=d.useRef(new Map),c=o==="curved",i=d.useCallback(h=>{const v=[],g=r.current,{nodes:E}=t.current;return h.forEach(y=>{const{target:x,source:b,size:a=1}=y,u=E.find(l=>l.id===b),f=E.find(l=>l.id===x);if(!u||!f)return;const p=`fromX:${u.position.x},fromY:${u.position.y},toX:${f.position.x}},toY:${f.position.y}`;if(g.has(p)){const l=g.get(p);v.push(l);return}const C=pe(u),D=u.size+n.edge.label.fontSize,w=pe(f),A=f.size+n.edge.label.fontSize;let G=fe(C,D,w,A,c),m=new Re(G,20,a/2,5,!1);if(e==="none"){v.push(m),g.set(p,m);return}const[I,_]=vt(a),[O,P]=gt(e,G,I),M=new et;M.setFromUnitVectors(new X(0,1,0),P);const j=new tn(0,_,I,20,1,!0);if(j.applyQuaternion(M),j.translate(O.x,O.y,O.z),e&&e==="end"){const l=fe(C,D,O,0,c);m=new Re(l,20,a/2,5,!1)}const V=ye([m,j]);v.push(V),g.set(p,V)}),v},[e,c,n.edge.label.fontSize]),s=d.useCallback((h,v)=>{const g=i(h),E=i(v);return ye([E.length?ye(E):Qe,g.length?ye(g):Qe],!0)},[i]);return{getGeometries:i,getGeometry:s}}function Un(e,o,t){const{onClick:n,onContextMenu:r,onPointerOut:c,onPointerOver:i}=e,s=N(b=>b.edgeContextMenus),h=N(b=>b.setEdgeContextMenus),v=d.useRef(!1),g=d.useCallback(()=>{v.current=!0},[]),E=d.useRef(!1),y=d.useCallback(()=>{E.current=!0},[]),x=d.useCallback((b,a)=>{n&&v.current&&(v.current=!1,t||a.forEach(u=>{n(u)})),(o||r)&&E.current&&(E.current=!1,t||a.forEach(u=>{s.has(u.id)||(h(new Set([...s,u.id])),r==null||r(u))})),i&&a.filter(f=>!b.includes(f)).forEach(f=>{i(f)}),c&&b.filter(f=>!a.includes(f)).forEach(f=>{c(f)})},[o,t,s,h,n,r,i,c]);return{handleClick:g,handleContextMenu:y,handleIntersections:x}}function Yn(e,o){const t=d.useRef(e);d.useEffect(()=>{t.current=e},[e]);const n=d.useCallback(()=>{const c=t.current.getAttribute("position"),i=Array.from({length:c.array.length}).fill(0),s=Array.from(c.array);return{from:i,to:s}},[]),r=d.useCallback(c=>{const i=new Float32Array(c),s=new nn(i,3,!1);t.current.setAttribute("position",s),s.needsUpdate=!0},[]);J(()=>{if(!o)return null;const c=n();return{from:{positions:c.from},to:{positions:c.to},onChange:i=>{r(i.value.positions)},config:{...ee,duration:o?void 0:0}}},[o])}function Wn(e,o,t){const[{activeOpacity:n,inactiveOpacity:r}]=J(()=>({from:{activeOpacity:0,inactiveOpacity:0},to:{activeOpacity:o?t.edge.selectedOpacity:t.edge.opacity,inactiveOpacity:o?t.edge.inactiveOpacity:t.edge.opacity},config:{...ee,duration:e?void 0:0}}),[e,o,t]);return{activeOpacity:n,inactiveOpacity:r}}const kt=({animated:e,color:o,contextMenu:t,edge:n,labelFontUrl:r,labelPlacement:c,opacity:i})=>{const s=N(m=>m.theme),{target:h,source:v,label:g,labelVisible:E=!1,size:y=1}=n,x=N(m=>m.nodes),b=x.find(m=>m.id===v),a=x.find(m=>m.id===h),u=N(m=>m.draggingId),f=(y+s.edge.label.fontSize)/2,p=d.useMemo(()=>mt(b.position,a.position,pt(f,c)),[b.position,a.position,f,c]),C=N(m=>m.edgeContextMenus),D=N(m=>m.setEdgeContextMenus),[{labelPosition:w}]=J(()=>({from:{labelPosition:[0,0,0]},to:{labelPosition:[p.x,p.y,p.z]},config:{...ee,duration:e&&!u?void 0:0}}),[p,e,u]),A=d.useCallback(m=>{C.delete(m.id),D(new Set(C.values()))},[C,D]),G=d.useMemo(()=>new nt(0,0,c==="natural"?0:Math.atan((a.position.y-b.position.y)/(a.position.x-b.position.x))),[a.position.x,a.position.y,b.position.x,b.position.y,c]);return k.jsxs("group",{children:[E&&g&&k.jsx(K.group,{position:w,children:k.jsx(ce,{text:g,ellipsis:15,fontUrl:r,stroke:s.edge.label.stroke,color:o,opacity:i,fontSize:s.edge.label.fontSize,rotation:G})}),t&&C.has(n.id)&&k.jsx(Le,{prepend:!0,center:!0,position:p,children:t({data:n,onClose:()=>A(n)})})]})};kt.defaultProps={labelPlacement:"inline"};const Kn=({interpolation:e="linear",arrowPlacement:o="end",labelPlacement:t="inline",animated:n,contextMenu:r,disabled:c,edges:i,labelFontUrl:s,onClick:h,onContextMenu:v,onPointerOut:g,onPointerOver:E})=>{const y=N(S=>S.theme),{getGeometries:x,getGeometry:b}=Hn(o,e),a=N(S=>S.draggingId),u=N(S=>S.edgeMeshes),f=N(S=>S.setEdgeMeshes),p=N(S=>S.actives||[]),C=N(S=>S.selections||[]),[D,w,A,G]=d.useMemo(()=>{const S=[],T=[],U=[],F=[];return i.forEach(W=>{if(a===W.source||a===W.target){C.includes(W.id)||p.includes(W.id)?U.push(W):F.push(W);return}C.includes(W.id)||p.includes(W.id)?S.push(W):T.push(W)}),[S,T,U,F]},[i,p,C,a]),m=!!C.length,I=d.useMemo(()=>b(D,w),[b,D,w]),{activeOpacity:_,inactiveOpacity:O}=Wn(n,m,y);Yn(I,n),d.useEffect(()=>{if(a===null){const T=x(i).map(U=>new Oe(U));f(T)}},[x,f,i,a]);const P=d.useRef(new Oe),M=d.useRef(new Oe),j=d.useCallback(S=>{if(!S.camera)return[];const T=S.intersectObjects(u);return T.length?T.map(U=>i[u.indexOf(U.object)]):[]},[u,i]),{handleClick:V,handleContextMenu:l,handleIntersections:R}=Un({onClick:h,onContextMenu:v,onPointerOut:g,onPointerOver:E},r,c),z=d.useRef(null),L=d.useRef([]);return Je(S=>{if(P.current.geometry=I,c)return;const T=z.current;if((a||a===null&&T!==null)&&(M.current.geometry=b(A,G)),z.current=a,a)return;const U=L.current,F=j(S.raycaster);R(U,F),F.join()!==U.join()&&(M.current.geometry=b(F,[])),L.current=F}),k.jsxs("group",{onClick:V,onContextMenu:l,children:[k.jsxs("mesh",{ref:P,children:[k.jsx(K.meshBasicMaterial,{attach:"material-0",color:y.edge.fill,depthTest:!1,fog:!0,opacity:O,side:ne,transparent:!0}),k.jsx(K.meshBasicMaterial,{attach:"material-1",color:y.edge.activeFill,depthTest:!1,fog:!0,opacity:_,side:ne,transparent:!0})]}),k.jsxs("mesh",{ref:M,children:[k.jsx(K.meshBasicMaterial,{attach:"material-0",color:y.edge.fill,depthTest:!1,fog:!0,opacity:O,side:ne,transparent:!0}),k.jsx(K.meshBasicMaterial,{attach:"material-1",color:y.edge.activeFill,depthTest:!1,fog:!0,opacity:_,side:ne,transparent:!0})]}),i.map(S=>k.jsx(kt,{animated:n,contextMenu:r,color:y.edge.label.color,disabled:c,edge:S,labelFontUrl:s,labelPlacement:t},S.id))]})},Nt=({animated:e,position:o,padding:t,labelFontUrl:n,disabled:r,radius:c,nodes:i,label:s,onClick:h,onPointerOver:v,onPointerOut:g})=>{var E,y,x,b,a;const u=N(z=>z.theme),f=Math.max(o.width,o.height)/2,p=f-c+t,[C,D]=d.useState(!1),w=N(z=>z.centerPosition),A=N(z=>{var L;return(L=z.actives)==null?void 0:L.some(S=>i.some(T=>T.id===S))}),G=N(z=>{var L;return(L=z.selections)==null?void 0:L.some(S=>i.some(T=>T.id===S))}),I=N(z=>{var L;return((L=z.selections)==null?void 0:L.length)>0})?G||C||A?(E=u.cluster)==null?void 0:E.selectedOpacity:(y=u.cluster)==null?void 0:y.inactiveOpacity:(x=u.cluster)==null?void 0:x.opacity,{circleOpacity:_,circlePosition:O,labelPosition:P}=J({from:{circlePosition:[w.x,w.y,-1],circleOpacity:0,labelPosition:[0,-p,2]},to:{labelPosition:[0,-p,2],circlePosition:o?[o.x,o.y,-1]:[0,0,-1],circleOpacity:I},config:{...ee,duration:e?void 0:0}}),M=d.useMemo(()=>{var z;return new se((z=u.cluster)==null?void 0:z.stroke)},[(b=u.cluster)==null?void 0:b.stroke]),j=d.useMemo(()=>{var z;return new se((z=u.cluster)==null?void 0:z.fill)},[(a=u.cluster)==null?void 0:a.fill]);de(C&&h!==void 0,"pointer");const{pointerOver:V,pointerOut:l}=De({disabled:r,onPointerOver:z=>{D(!0),v==null||v({nodes:i,label:s},z)},onPointerOut:z=>{D(!1),g==null||g({nodes:i,label:s},z)}});return d.useMemo(()=>{var z,L,S;return u.cluster&&k.jsxs(K.group,{position:O,onPointerOver:V,onPointerOut:l,onClick:T=>{r||h==null||h({nodes:i,label:s},T)},children:[k.jsxs("mesh",{children:[k.jsx("ringGeometry",{attach:"geometry",args:[p,0,128]}),k.jsx(K.meshBasicMaterial,{attach:"material",color:j,transparent:!0,depthTest:!1,opacity:(z=u.cluster)!=null&&z.fill?_:0,side:ne,fog:!0})]}),k.jsxs("mesh",{children:[k.jsx("ringGeometry",{attach:"geometry",args:[p,f+t,128]}),k.jsx(K.meshBasicMaterial,{attach:"material",color:M,transparent:!0,depthTest:!1,opacity:_,side:ne,fog:!0})]}),((L=u.cluster)==null?void 0:L.label)&&k.jsx(K.group,{position:P,children:k.jsx(ce,{text:s,opacity:I,fontUrl:n,stroke:u.cluster.label.stroke,active:!1,color:(S=u.cluster)==null?void 0:S.label.color,fontSize:12})})]})},[u.cluster,O,V,l,p,j,_,f,t,M,P,s,I,n,r,h,i])};Nt.defaultProps={radius:2,padding:40};const Rt=d.forwardRef(({onNodeClick:e,onNodeDoubleClick:o,onNodeContextMenu:t,onEdgeContextMenu:n,onEdgeClick:r,onEdgePointerOver:c,onEdgePointerOut:i,onNodePointerOver:s,onNodePointerOut:h,onClusterClick:v,onNodeDragged:g,onClusterPointerOver:E,onClusterPointerOut:y,contextMenu:x,animated:b,disabled:a,draggable:u,edgeLabelPosition:f,edgeArrowPosition:p,edgeInterpolation:C,labelFontUrl:D,renderNode:w,...A},G)=>{const{layoutType:m,clusterAttribute:I}=A,_=$(F=>F.gl),O=$(F=>F.scene),P=$(F=>F.camera);if(Vn(A),I&&!(m==="forceDirected2d"||m==="forceDirected3d"))throw new Error("Clustering is only supported for the force directed layouts.");const M=N(F=>F.graph),j=N(F=>F.nodes),V=N(F=>F.edges),l=N(F=>[...F.clusters.values()]),{centerNodesById:R,fitNodesInViewById:z,isCentered:L}=Bn({animated:b,disabled:a,layoutType:m});d.useImperativeHandle(G,()=>({centerGraph:R,fitNodesInView:z,graph:M,renderScene:()=>_.render(O,P)}),[R,z,M,_,O,P]);const S=d.useMemo(()=>j.map(F=>k.jsx(_t,{id:F==null?void 0:F.id,labelFontUrl:D,draggable:u,disabled:a,animated:b,contextMenu:x,renderNode:w,onClick:e,onDoubleClick:o,onContextMenu:t,onPointerOver:s,onPointerOut:h,onDragged:g},F==null?void 0:F.id)),[b,x,a,u,D,j,e,t,o,g,h,s,w]),T=d.useMemo(()=>b?V.map(F=>k.jsx(Ot,{id:F.id,disabled:a,animated:b,labelFontUrl:D,labelPlacement:f,arrowPlacement:p,interpolation:C,contextMenu:x,onClick:r,onContextMenu:n,onPointerOver:c,onPointerOut:i},F.id)):k.jsx(Kn,{edges:V,disabled:a,animated:b,labelFontUrl:D,labelPlacement:f,arrowPlacement:p,interpolation:C,contextMenu:x,onClick:r,onContextMenu:n,onPointerOver:c,onPointerOut:i}),[b,x,a,p,C,f,V,D,r,n,i,c]),U=d.useMemo(()=>l.map(F=>k.jsx(Nt,{animated:b,disabled:a,labelFontUrl:D,onClick:v,onPointerOver:E,onPointerOut:y,...F},F.label)),[b,l,a,D,v,y,E]);return L&&k.jsxs(d.Fragment,{children:[T,S,U]})});Rt.defaultProps={edgeInterpolation:"linear"};const Xn={canvas:{background:"#fff"},node:{fill:"#7CA0AB",activeFill:"#1DE9AC",opacity:1,selectedOpacity:1,inactiveOpacity:.2,label:{color:"#2A6475",stroke:"#fff",activeColor:"#1DE9AC"},subLabel:{color:"#ddd",stroke:"transparent",activeColor:"#1DE9AC"}},lasso:{border:"1px solid #55aaff",background:"rgba(75, 160, 255, 0.1)"},ring:{fill:"#D8E6EA",activeFill:"#1DE9AC"},edge:{fill:"#D8E6EA",activeFill:"#1DE9AC",opacity:1,selectedOpacity:1,inactiveOpacity:.1,label:{stroke:"#fff",color:"#2A6475",activeColor:"#1DE9AC",fontSize:6}},arrow:{fill:"#D8E6EA",activeFill:"#1DE9AC"},cluster:{stroke:"#D8E6EA",opacity:1,selectedOpacity:1,inactiveOpacity:.1,label:{stroke:"#fff",color:"#2A6475"}}};function xe(e,o,t){const{offsetX:n,offsetY:r}=e,{width:c,height:i}=t;o.set(n/c*2-1,-(r/i)*2+1)}function $n(e){const o=document.createElement("div");return o.style.pointerEvents="none",o.style.border=e.lasso.border,o.style.backgroundColor=e.lasso.background,o.style.position="fixed",o}const Zn=({children:e,type:o="none",onLasso:t,onLassoEnd:n,disabled:r})=>{var c;const i=N(M=>M.theme),s=$(M=>M.camera),h=$(M=>M.gl),v=$(M=>M.setEvents),g=$(M=>M.size),E=$(M=>M.get),y=$(M=>M.scene),x=Ae(),b=N(M=>M.actives),a=N(M=>M.setActives),u=N(M=>M.edges),f=N(M=>M.edgeMeshes),p=d.useRef(!1),C=d.useRef(null),D=d.useRef(null),w=d.useRef($n(i)),A=d.useRef(null),G=d.useRef(!1),m=d.useRef(E().events.enabled),I=d.useRef((c=x.controls)==null?void 0:c.enabled);d.useEffect(()=>{p.current&&(t==null||t(b)),p.current=!0},[b,t]);const _=d.useCallback(M=>{if(G.current){const[j,V,l]=A.current;l.x=Math.max(j.x,M.clientX),l.y=Math.max(j.y,M.clientY),V.x=Math.min(j.x,M.clientX),V.y=Math.min(j.y,M.clientY),w.current.style.left=`${V.x}px`,w.current.style.top=`${V.y}px`,w.current.style.width=`${l.x-V.x}px`,w.current.style.height=`${l.y-V.y}px`,xe(M,C.current.endPoint,g),xe(M,D.current.endPoint,g);const R=[],z=D.current.select().sort(S=>S.uuid).map(S=>u[f.indexOf(S)].id);R.push(...z);const L=C.current.select().sort(S=>S.uuid).filter(S=>{var T,U;return S.isMesh&&((T=S.userData)==null?void 0:T.id)&&(((U=S.userData)==null?void 0:U.type)===o||o==="all")}).map(S=>S.userData.id);R.push(...L),requestAnimationFrame(()=>{a(R)}),document.addEventListener("pointermove",_,{passive:!0,capture:!0,once:!0})}},[u,f,a,g,o]),O=d.useCallback(()=>{var M;G.current&&(v({enabled:m.current}),G.current=!1,(M=w.current.parentElement)==null||M.removeChild(w.current),x.controls.enabled=I.current,n==null||n(b),document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",O))},[v,x.controls,n,b,_]),P=d.useCallback(M=>{var j,V;if(M.shiftKey){m.current=E().events.enabled,I.current=(j=x.controls)==null?void 0:j.enabled,C.current=new je(s,y);const l=new $t;f.length&&l.add(...f),D.current=new je(s,l),A.current=[new ue,new ue,new ue];const[R]=A.current;x.controls.enabled=!1,v({enabled:!1}),G.current=!0,(V=h.domElement.parentElement)==null||V.appendChild(w.current),w.current.style.left=`${M.clientX}px`,w.current.style.top=`${M.clientY}px`,w.current.style.width="0px",w.current.style.height="0px",R.x=M.clientX,R.y=M.clientY,xe(M,C.current.startPoint,g),xe(M,D.current.startPoint,g),document.addEventListener("pointermove",_,{passive:!0,capture:!0,once:!0}),document.addEventListener("pointerup",O,{passive:!0})}},[s,x.controls,f,E,h.domElement.parentElement,_,O,y,v,g]);return d.useEffect(()=>{if(!(r||o==="none"))return typeof window<"u"&&(document.addEventListener("pointerdown",P,{passive:!0}),document.addEventListener("pointermove",_,{passive:!0}),document.addEventListener("pointerup",O,{passive:!0})),()=>{typeof window<"u"&&(document.removeEventListener("pointerdown",P),document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",O))}},[o,r,P,_,O]),k.jsx("group",{children:e})},qn="_canvas_670zp_1",Qn={canvas:qn},Jn={alpha:!0,antialias:!0},eo={position:[0,0,1e3],near:5,far:5e4,fov:10},to=d.forwardRef(({cameraMode:e,edges:o,children:t,nodes:n,theme:r,minDistance:c,maxDistance:i,onCanvasClick:s,animated:h,disabled:v,lassoType:g,onLasso:E,onLassoEnd:y,glOptions:x,...b},a)=>{var u,f;const p=d.useRef(null),C=d.useRef(null),D=d.useRef(null);d.useImperativeHandle(a,()=>({centerGraph:(_,O)=>{var P;return(P=p.current)==null?void 0:P.centerGraph(_,O)},fitNodesInView:(_,O)=>{var P;return(P=p.current)==null?void 0:P.fitNodesInView(_,O)},zoomIn:()=>{var _;return(_=C.current)==null?void 0:_.zoomIn()},zoomOut:()=>{var _;return(_=C.current)==null?void 0:_.zoomOut()},dollyIn:_=>{var O;return(O=C.current)==null?void 0:O.dollyIn(_)},dollyOut:_=>{var O;return(O=C.current)==null?void 0:O.dollyOut(_)},panLeft:()=>{var _;return(_=C.current)==null?void 0:_.panLeft()},panRight:()=>{var _;return(_=C.current)==null?void 0:_.panRight()},panDown:()=>{var _;return(_=C.current)==null?void 0:_.panDown()},panUp:()=>{var _;return(_=C.current)==null?void 0:_.panUp()},resetControls:_=>{var O;return(O=C.current)==null?void 0:O.resetControls(_)},getControls:()=>{var _;return(_=C.current)==null?void 0:_.controls},getGraph:()=>{var _;return(_=p.current)==null?void 0:_.graph},exportCanvas:()=>(p.current.renderScene(),D.current.toDataURL())}));const{selections:w,actives:A,collapsedNodeIds:G}=b,m=o.length+n.length>400?!1:h,I=d.useMemo(()=>({...x,...Jn}),[x]);return k.jsx("div",{className:Qn.canvas,children:k.jsx(Lt,{legacy:!0,linear:!0,ref:D,flat:!0,gl:I,camera:eo,onPointerMissed:s,children:k.jsxs(Pn,{createStore:()=>jn({selections:w,actives:A,theme:r,collapsedNodeIds:G}),children:[((u=r.canvas)==null?void 0:u.background)&&k.jsx("color",{attach:"background",args:[r.canvas.background]}),k.jsx("ambientLight",{intensity:1}),t,((f=r.canvas)==null?void 0:f.fog)&&k.jsx("fog",{attach:"fog",args:[r.canvas.fog,4e3,9e3]}),k.jsx(Ct,{mode:e,ref:C,disabled:v,minDistance:c,maxDistance:i,animated:h,children:k.jsx(Zn,{disabled:v,type:g,onLasso:E,onLassoEnd:y,children:k.jsx(d.Suspense,{children:k.jsx(Rt,{ref:p,disabled:v,animated:m,edges:o,nodes:n,...b})})})})]})})})});to.defaultProps={cameraMode:"pan",layoutType:"forceDirected2d",sizingType:"default",labelType:"auto",theme:Xn,animated:!0,defaultNodeSize:7,minNodeSize:5,maxNodeSize:15,lassoType:"none",glOptions:{}};export{to as G};
